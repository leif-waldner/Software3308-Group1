<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.9.1">
  <compounddef id="scripts_2scripts_8js" kind="file" language="Javascript">
    <compoundname>scripts.js</compoundname>
      <sectiondef kind="var">
      <memberdef kind="variable" id="scripts_2scripts_8js_1ae2475e10618961c050dcba04e8c42331" prot="public" static="no" mutable="no">
        <type>use</type>
        <definition>use strict</definition>
        <argsstring></argsstring>
        <name>strict</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/leif/Dropbox/Software3308-Group1/FinalSubmission/GeoReport/scripts/scripts.js" line="1" column="1" bodyfile="/home/leif/Dropbox/Software3308-Group1/FinalSubmission/GeoReport/scripts/scripts.js" bodystart="1" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="scripts_2scripts_8js_1aebedbf53ce9a15014605e527aec0a6ec" prot="public" static="no" mutable="no">
        <type>var</type>
        <definition>var resolve</definition>
        <argsstring></argsstring>
        <name>resolve</name>
        <initializer>={delay:function($q,$timeout){var delay=$q.defer();return $timeout(delay.resolve,0,!1),delay.promise}}</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/leif/Dropbox/Software3308-Group1/FinalSubmission/GeoReport/scripts/scripts.js" line="1" column="1" bodyfile="/home/leif/Dropbox/Software3308-Group1/FinalSubmission/GeoReport/scripts/scripts.js" bodystart="1" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="scripts_2scripts_8js_1a1c5b7e03e985c7bd794996960059f6a8" prot="public" static="no" mutable="no">
        <type>angular</type>
        <definition>function $locationProvider</definition>
        <argsstring></argsstring>
        <name>$locationProvider</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/leif/Dropbox/Software3308-Group1/FinalSubmission/GeoReport/scripts/scripts.js" line="1" column="1" bodyfile="/home/leif/Dropbox/Software3308-Group1/FinalSubmission/GeoReport/scripts/scripts.js" bodystart="1" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="scripts_2scripts_8js_1a1e1423178c7539e8b3ffb644d7727d12" prot="public" static="no" mutable="no">
        <type>angular</type>
        <definition>function $httpProvider</definition>
        <argsstring></argsstring>
        <name>$httpProvider</name>
        <initializer>{$routeProvider.when(&quot;/&quot;,{templateUrl:&quot;views/main.html&quot;,controller:&quot;MainCtrl&quot;,resolve:resolve}).when(&quot;/all&quot;,{templateUrl:&quot;views/all.html&quot;,controller:&quot;AllCtrl&quot;,resolve:resolve}).when(&quot;/create&quot;,{templateUrl:&quot;views/create.html&quot;,controller:&quot;CreateCtrl&quot;,resolve:resolve}).when(&quot;/featured&quot;,{templateUrl:&quot;views/drop.html&quot;,controller:&quot;DropCtrl&quot;,reloadOnSearch:!1,resolve:resolve}).when(&quot;/drop/:id&quot;,{templateUrl:&quot;views/drop.html&quot;,controller:&quot;DropCtrl&quot;,reloadOnSearch:!1,resolve:resolve}).otherwise({redirectTo:&quot;/&quot;}),$httpProvider.defaults.headers.post[&quot;Content-Type&quot;]=&quot;application/x-www-form-urlencoded;charset=utf-8&quot;</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/leif/Dropbox/Software3308-Group1/FinalSubmission/GeoReport/scripts/scripts.js" line="1" column="1" bodyfile="/home/leif/Dropbox/Software3308-Group1/FinalSubmission/GeoReport/scripts/scripts.js" bodystart="1" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="scripts_2scripts_8js_1ae0edb698f996e9ec8e007db785a90717" prot="public" static="no" mutable="no">
        <type>function</type>
        <definition>function $routeProvider</definition>
        <argsstring></argsstring>
        <name>$routeProvider</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/leif/Dropbox/Software3308-Group1/FinalSubmission/GeoReport/scripts/scripts.js" line="1" column="1" bodyfile="/home/leif/Dropbox/Software3308-Group1/FinalSubmission/GeoReport/scripts/scripts.js" bodystart="1" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="scripts_2scripts_8js_1a9577b5cc54fa04bbb8fa6050e1ade3af" prot="public" static="no" mutable="no">
        <type>var</type>
        <definition>var param</definition>
        <argsstring></argsstring>
        <name>param</name>
        <initializer>=function(obj){var name,value,fullSubName,subName,subValue,innerObj,i,query=&quot;&quot;;for(name in obj)if(value=obj[name],value instanceof Array)for(i=0;i&lt;value.length;++i)subValue=value[i],fullSubName=name+&quot;[&quot;+i+&quot;]&quot;,innerObj={},innerObj[fullSubName]=subValue,query+=param(innerObj)+&quot;&amp;&quot;;<ref refid="getrss_8php_1a28ce50e914c2968ab9495fdd1514c759" kindref="member">else</ref> if(value instanceof Object)for(subName in value)subValue=value[subName],fullSubName=name+&quot;[&quot;+subName+&quot;]&quot;,innerObj={},innerObj[fullSubName]=subValue,query+=param(innerObj)+&quot;&amp;&quot;;<ref refid="getrss_8php_1a28ce50e914c2968ab9495fdd1514c759" kindref="member">else</ref> void 0!==value&amp;&amp;null!==value&amp;&amp;(query+=encodeURIComponent(name)+&quot;=&quot;+encodeURIComponent(value)+&quot;&amp;&quot;);return query.length?query.substr(0,query.length-1):query}</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/leif/Dropbox/Software3308-Group1/FinalSubmission/GeoReport/scripts/scripts.js" line="1" column="1" bodyfile="/home/leif/Dropbox/Software3308-Group1/FinalSubmission/GeoReport/scripts/scripts.js" bodystart="1" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="scripts_2scripts_8js_1a888a1dff4d9834f10ef0cbfa15c58d1a" prot="public" static="no" mutable="no">
        <type>$httpProvider defaults</type>
        <definition>$httpProvider defaults transformRequest</definition>
        <argsstring></argsstring>
        <name>transformRequest</name>
        <initializer>=[function(data){return angular.isObject(data)&amp;&amp;&quot;[object File]&quot;!==String(data)?param(data):data}]}]).run([&quot;$rootScope&quot;,&quot;$location&quot;,&quot;$route&quot;,&quot;$timeout&quot;,&quot;Spotify&quot;,&quot;ngProgress&quot;,function($rootScope,$location,$route,$timeout,Spotify,ngProgress){var token_key=&quot;access_token=&quot;,token_index=window.location.href.indexOf(token_key);if(token_index&gt;-1){var token=window.location.href.substr(token_index+token_key.length).split(&quot;&amp;&quot;)[0];Spotify.set_access_token(token),$location.path(&quot;/create&quot;)}var oldLocation=&quot;&quot;;$rootScope.$on(&quot;$routeChangeStart&quot;,function(angularEvent,next){$rootScope.view_class=&quot;view-&quot;+$location.path().substr(1),ngProgress.reset();var isForwards=!0;if(next&amp;&amp;next.$$route){var newLocation=next.$$route.originalPath;oldLocation!==newLocation&amp;&amp;-1!==oldLocation.indexOf(newLocation)&amp;&amp;(isForwards=!1),oldLocation=newLocation}}),ngProgress.color(&quot;#16e58a&quot;)}]),angular.module(&quot;dropApp&quot;).service(&quot;Image&quot;,function(){function hexToRgb(hex){var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return result?{r:parseInt(result[1],16),g:parseInt(result[2],16),b:parseInt(result[3],16)}:null}this.grayscale=function(pixels){for(var d=pixels.data,i=0;i&lt;d.length;i+=4){var r=d[i],g=d[i+1],b=d[i+2],v=.2126*r+.7152*g+.0722*b;d[i]=d[i+1]=d[i+2]=v}return pixels},this.duotone=function(img,tone1,tone2){var gradient=this.gradientMap(tone1,tone2);img=this.grayscale(img);for(var d=img.data,i=0;i&lt;d.length;i+=4)d[i]=gradient[4*d[i]],d[i+1]=gradient[4*d[i+1]+1],d[i+2]=gradient[4*d[i+2]+2];return img},this.gradientMap=function(tone1,tone2){for(var rgb1=hexToRgb(tone1),rgb2=hexToRgb(tone2),gradient=[],i=0;1024&gt;i;i+=4)gradient[i]=((256-i/4)*rgb1.r+i/4*rgb2.r)/256,gradient[i+1]=((256-i/4)*rgb1.g+i/4*rgb2.g)/256,gradient[i+2]=((256-i/4)*rgb1.b+i/4*rgb2.b)/256,gradient[i+3]=255;return gradient},this.flipImage=function(input){for(var tempCtx=document.createElement(&quot;canvas&quot;).getContext(&quot;2d&quot;),output=tempCtx.createImageData(input.width,input.height),w=input.width,h=input.height,inputData=input.data,outputData=output.data,y=1;h-1&gt;y;y+=1)for(var x=1;w-1&gt;x;x+=1)for(var i=4*(y*w+x),flip=4*(y*w+(w-x)),c=0;4&gt;c;c+=1)outputData[i+c]=inputData[flip+c];return output}}),angular.module(&quot;dropApp&quot;).service(&quot;BlockFormatter&quot;,function(){this.format_media=function(media,parent){var block={};switch(block.type=&quot;media&quot;,block.media_type=media.drop_type,block.title=media.title?media.title:&quot;Check out this exclusive &quot;+media.drop_type+&quot;!&quot;,block.description=media.description?media.description:&quot;Love &quot;+parent.name+&quot;? Don&apos;t miss this!&quot;,block.url=&quot;/drop/&quot;+media.artist_id+&quot;?media=&quot;+media.id,media.drop_type){case&quot;video&quot;:block.call_to_action=&quot;watch now&quot;;break;case&quot;gallery&quot;:block.call_to_action=&quot;gallery&quot;;break;case&quot;playlist&quot;:block.call_to_action=&quot;follow&quot;}return block},this.format_drop=function(data){var block={};return block.type=&quot;drop&quot;,block.title=data.name,block.image=data.files[data.featured_image_id].url,block.url=&quot;/drop/&quot;+data.id,block.call_to_action=&quot;view drop&quot;,block}}),angular.module(&quot;dropApp&quot;).service(&quot;Spotify&quot;,[&quot;$http&quot;,&quot;$location&quot;,&quot;$window&quot;,&quot;$q&quot;,function($http,$location,$window,$q){var access_token,user,client_id=&quot;d8c2bf8b2663462e93004f0575f821e8&quot;,redirect_uri=&quot;http://spotify-thedrop.com/&quot;,authorization_url=&quot;https://accounts.spotify.com/authorize&quot;,api_base=&quot;https://api.spotify.com/v1&quot;;this.set_access_token=function(token){access_token=token},this.get_access_token=function(){return access_token},this.authenticate=function(){var url_string=authorization_url+&quot;?response_type=token&amp;client_id=&quot;+client_id+&quot;&amp;redirect_uri=&quot;+redirect_uri;$window.location.href=url_string},this.get_user=function(){var deferred=$q.defer();return user?deferred.resolve(user):$http({url:api_base+&quot;/me&quot;,headers:{Authorization:&quot;Bearer &quot;+access_token}}).success(function(response){deferred.resolve(user=response)}).error(function(response){deferred.reject()}),deferred.promise}}]),angular.module(&quot;dropApp&quot;).service(&quot;Api&quot;,[&quot;$http&quot;,&quot;$q&quot;,function($http,$q){function card_shim(raw){for(var i=0;i&lt;raw.length;i++)raw[i].type=&quot;card&quot;;return raw}function drop_shim(data){function get_image_url(id){return data.files[id]?data.files[id].url:null}function get_image_content_url(i,id){return data.content[i].files[id]?data.content[i].files[id].url:null}var now=(new Date).getTime();data.type=&quot;drop&quot;,data.featured_image=get_image_url(data.featured_image_id),data.header_image=get_image_url(data.header_image_id),data.dropped_at=moment(data.reveal_date).fromNow(),data.single_uri=&quot;spotify:track:&quot;+data.single,data.dropped=moment(data.release_date).isAfter(now),&quot;i&quot;===data.dropped_at.charAt(0)&amp;&amp;&quot;n&quot;===data.dropped_at.charAt(1)?data.dropped_at=&quot;Dropping &quot;+data.dropped_at:data.dropped_at=&quot;Dropped &quot;+data.dropped_at,data.card_images=[];var card_image_1=get_image_url(data.artist_image1_id),card_image_2=get_image_url(data.artist_image2_id),card_image_3=get_image_url(data.artist_image3_id);if(card_image_1&amp;&amp;data.card_images.push(card_image_1),card_image_2&amp;&amp;data.card_images.push(card_image_2),card_image_3&amp;&amp;data.card_images.push(card_image_3),data.content)for(var i=0;i&lt;data.content.length;i++){var content=data.content[i];content.item_index=i,content.type=&quot;media&quot;,content.media_type=content.content_type,content.media_index=i,content.featured_image=get_image_content_url(i,content.featured_image_id),content.dropped_at=moment(content.release_date).fromNow(),content.drop_id=data.id,content.locked=moment(content.release_date).isAfter(now)}return data}var drops,cards,base=&quot;http://spotify-thedrop-api.herokuapp.com&quot;;this.get_drop=function(id){var deferred=$q.defer();return $http.get(base+&quot;/drop/&quot;+id+&quot;/&quot;).success(function(response){deferred.resolve(drop_shim(response))}),deferred.promise},this.get_all_drops=function(){var deferred=$q.defer();return drops?deferred.resolve(drops):$http.get(base+&quot;/drops&quot;).success(function(response){for(var i=0;i&lt;response.length;i++)response[i]=drop_shim(response[i]);deferred.resolve(drops=response)}),deferred.promise},this.get_featured=function(){var deferred=$q.defer();return $http.get(base+&quot;/drops?featured=1&quot;).success(function(response){deferred.resolve(drop_shim(response[response.length-1]))}),deferred.promise},this.get_cards=function(){var deferred=$q.defer();return cards?deferred.resolve(cards):$http.get(base+&quot;/cards?featured=1/&quot;).success(function(response){cards=card_shim(response),deferred.resolve(cards)}),deferred.promise},this.get_single_card=function(route){var deferred=$q.defer();return cards?deferred.resolve(cards):$http.get(route).success(function(response){deferred.resolve(response)}),deferred.promise},this.get_ad=function(){var deferred=$q.defer();return $http.get(base+&quot;/api/brands_list&quot;).success(function(response){var latestResponse=response[response.length-1];latestResponse.type=&quot;ad&quot;,latestResponse.image=latestResponse.files[latestResponse.image_id].url,deferred.resolve(latestResponse)}),deferred.promise},this.save_card=function(card_data,image){var deferred=$q.defer(),data={drop_id:card_data.drop.id,creator_id:card_data.user.id,image:image};return $http({method:&quot;POST&quot;,url:base+&quot;/card/&quot;,data:data,headers:{&quot;Content-Type&quot;:&quot;application/x-www-form-urlencoded&quot;}}).success(function(response,status,headers,config){deferred.resolve(&quot;&quot;+base+headers().location)}),deferred.promise}}]),angular.module(&quot;dropApp&quot;).controller(&quot;MainCtrl&quot;,[&quot;$scope&quot;,&quot;$timeout&quot;,&quot;$q&quot;,&quot;$location&quot;,&quot;Api&quot;,&quot;ngProgress&quot;,function($scope,$timeout,$q,$location,Api,ngProgress){$scope.items=[];var featured=2;$scope.selectFeature=function(setFeature){featured=setFeature},$scope.isFeatured=function(checkFeature){return featured===checkFeature},this.load_featured_drop=function(){Api.get_featured().then(function(response){ngProgress.complete(),$scope.featured=response,$scope.$on(&quot;imageLoaded&quot;,function(){$timeout(function(){$scope.backgroundLoaded=!0,$scope.firstLoad=!0;media:for(var i=$scope.featured.content.length;i--;i&gt;=0)if(!$scope.featured.content[i].locked){$scope.items.unshift($scope.featured.content[i]),$scope.items[0].name=$scope.featured.name,$timeout(function(){$scope.firstLoad=!1},1e3);break media}$timeout(function(){Api.get_ad().then(function(response){$scope.items.push(response)}),$scope.ready=!0},1600)},700)})})};var random_drops,random_cards;$scope.load_random_assets=function(){ngProgress.start(),$q.all([Api.get_all_drops(),Api.get_cards()]).then(function(response){ngProgress.complete(),random_drops=angular.copy(response[0]),random_cards=angular.copy(response[1]),$scope.add_random_assets()})},$scope.add_random_assets=function(){if($scope.ready=!1,!random_drops||!random_drops.length)return $scope.load_random_assets(),!1;for(var random_items=[],random_index=Math.floor(Math.random()*(random_drops.length-4)),random_range=random_drops.splice(random_index,5),i=0;i&lt;random_range.length;i++){var selected_drop=random_range[i],selected_drop_media_length=selected_drop.content?selected_drop.content.length:0,selected_random_index=Math.floor(Math.random()*(selected_drop_media_length+1));selected_random_index===selected_drop_media_length?random_items.push(selected_drop):(selected_drop.content[selected_random_index].name=selected_drop.name,random_items.push(selected_drop.content[selected_random_index]))}if(random_cards.length){var random_card_index=Math.floor(Math.random()*(random_items.length-1));random_items.splice(random_card_index,0,random_cards.pop())}$scope.items=$scope.items.concat(random_items),$scope.ready=!0},this.load_featured_drop()}]),angular.module(&quot;dropApp&quot;).controller(&quot;HeaderCtrl&quot;,[&quot;$scope&quot;,&quot;$location&quot;,function($scope,$location){$scope.links=[{title:&quot;FEATURED&quot;,path:&quot;/drop/featured&quot;},{title:&quot;ALL&quot;,path:&quot;/all&quot;},{title:&quot;CREATE&quot;,path:&quot;/create&quot;}],$scope.visisble=!0,$scope.toggleShare=function(toggle){var $shareButtons=$(&quot;.share-button&quot;),buttonsNum=$shareButtons.length,buttonsMid=buttonsNum/3,spacing=90;$scope.visisble&amp;&amp;&quot;close&quot;!==toggle?($shareButtons.each(function(i){var $cur=$(this),pos=i-1,dist=Math.abs(pos);$cur.css({zIndex:buttonsMid-dist}),TweenMax.to($cur,1.1*dist,{x:pos*spacing,y:90,scale:.95,width:60,height:60,ease:Elastic.easeOut,easeParams:[1.01,.5]}),TweenMax.to($cur,.8,{delay:.2*dist-.1,scale:.95,width:60,height:60,ease:Elastic.easeOut,easeParams:[1.1,.6]}),TweenMax.fromTo($cur.children(&quot;.share-icon&quot;),.2,{scale:0},{delay:.2*dist-.1,scale:1,ease:Quad.easeInOut})}),$scope.visisble=!$scope.visisble):&quot;close&quot;===toggle?($shareButtons.each(function(i){var $cur=$(this),pos=i,dist=Math.abs(pos);$cur.css({zIndex:dist}),TweenMax.to($cur,.4+.1*(buttonsMid-dist),{x:0,y:0,scale:0,width:32,height:32,ease:Quad.easeInOut}),TweenMax.to($cur.children(&quot;.share-icon&quot;),.2,{scale:0,ease:Quad.easeIn})}),$scope.visisble=!0):($shareButtons.each(function(i){var $cur=$(this),pos=i,dist=Math.abs(pos);$cur.css({zIndex:dist}),TweenMax.to($cur,.4+.1*(buttonsMid-dist),{x:0,y:0,scale:0,width:32,height:32,ease:Quad.easeInOut}),TweenMax.to($cur.children(&quot;.share-icon&quot;),.2,{scale:0,ease:Quad.easeIn})}),$scope.visisble=!0)},$scope.$on(&quot;$locationChangeSuccess&quot;,function(e,next){$scope.path=$location.path(),$scope.toggleShare(&quot;close&quot;)}),$scope.path=$location.path()}]),angular.module(&quot;dropApp&quot;).controller(&quot;FeaturedCtrl&quot;,[&quot;$scope&quot;,&quot;$timeout&quot;,&quot;$q&quot;,&quot;$location&quot;,&quot;Api&quot;,&quot;ngProgress&quot;,function($scope,$timeout,$q,$location,Api,ngProgress){$scope.items=[],this.load_featured_drop=function(){ngProgress.start(),Api.get_featured().then(function(response){ngProgress.complete(),$timeout(function(){$scope.featured=response;media:for(var i=$scope.quantity;i--;i&gt;=0)if(!$scope.featured.content[i].locked){$scope.items.unshift($scope.featured.content[i]);break media}Api.get_ad().then(function(response){$scope.items.push(response)}),$scope.ready=!0},500)})};var random_drops,random_cards;$scope.load_random_assets=function(){ngProgress.start(),$q.all([Api.get_all_drops(),Api.get_cards()]).then(function(response){ngProgress.complete(),random_drops=angular.copy(response[0]),random_cards=angular.copy(response[1]),$scope.add_random_assets()})},$scope.add_random_assets=function(){if($scope.ready=!1,!random_drops||!random_drops.length)return $scope.load_random_assets(),!1;for(var random_items=[],random_index=Math.floor(Math.random()*(random_drops.length-4)),random_range=random_drops.splice(random_index,5),i=0;i&lt;random_range.length;i++){var selected_drop=random_range[i],selected_drop_media_length=selected_drop.content?selected_drop.content.length:0,selected_random_index=Math.floor(Math.random()*(selected_drop_media_length+1));selected_random_index===selected_drop_media_length?random_items.push(selected_drop):random_items.push(selected_drop.content[selected_random_index])}if(random_cards.length){var random_card_index=Math.floor(Math.random()*(random_items.length-1));random_items.splice(random_card_index,0,random_cards.pop())}$scope.items=$scope.items.concat(random_items),$scope.ready=!0},this.load_featured_drop()}]),angular.module(&quot;dropApp&quot;).controller(&quot;AllCtrl&quot;,[&quot;$scope&quot;,&quot;$timeout&quot;,&quot;Api&quot;,&quot;ngProgress&quot;,function($scope,$timeout,Api,ngProgress){$scope.limit=6,$scope.limit_per_page=6,$scope.visible=!1,this.load_drops=function(){ngProgress.start(),Api.get_all_drops().then(function(response){ngProgress.complete(),$timeout(function(){$scope.drops=response.reverse(),$scope.visible=!0},500)})},$scope.background=&quot;/images/auth/all.jpg&quot;,$scope.next_page=function(){$scope.limit=$scope.limit+$scope.limit_per_page},this.load_drops()}]),angular.module(&quot;dropApp&quot;).controller(&quot;CreateCtrl&quot;,[&quot;$scope&quot;,&quot;$q&quot;,&quot;$timeout&quot;,&quot;Api&quot;,&quot;Spotify&quot;,&quot;ngProgress&quot;,function($scope,$q,$timeout,Api,Spotify,ngProgress){$scope.card={},$scope.imageUrl=&quot;spotify-thedrop.com&quot;,$scope.auth_blocked=!Spotify.get_access_token(),$scope.auth_blocked||(ngProgress.start(),$scope.auth_blocked=!1,$q.all([Spotify.get_user(),Api.get_all_drops()]).then(function(response){ngProgress.complete(),$scope.card.drop=response[1][0],$scope.card.track=$scope.card.drop.song_list[0],$scope.$watch(&quot;card.drop&quot;,function(){$scope.card.track=$scope.card.drop.song_list[0],$scope.randomize()},!0),$timeout(function(){$timeout(function(){$scope.drops=response[1],$scope.card.user=response[0]},500)},500)},function(response){ngProgress.complete(),$scope.auth_blocked=!0,console.log(&quot;error&quot;)})),$scope.authenticate=function(){Spotify.authenticate()},$scope.themes=[{text:&quot;#F59B23&quot;,foreground:&quot;#AF2896&quot;,background:&quot;#503750&quot;,value:0},{text:&quot;#2D46B9&quot;,foreground:&quot;#CDF564&quot;,background:&quot;#FF4632&quot;,value:1},{text:&quot;#F573A0&quot;,foreground:&quot;#9BF0E1&quot;,background:&quot;#503750&quot;,value:2},{text:&quot;#000000&quot;,foreground:&quot;#FAE62D&quot;,background:&quot;#F037A5&quot;,value:3}],$scope.background=&quot;/images/auth/auth.png&quot;,$scope.bursts=[&quot;/images/bursts/triangle.png&quot;,&quot;/images/bursts/rectangle.png&quot;,&quot;/images/bursts/circle.png&quot;],$scope.select_type=function(type){$scope.card.type=type},$scope.select_burst=function(burst){$scope.card.burst=burst},$scope.select_image=function(image){$scope.card.image=image},$scope.select_theme=function(theme){$scope.card.theme=theme},$scope.scale_background=function(){$scope.card.scale=!$scope.card.scale},$scope.flip_background=function(){$scope.card.flip=!$scope.card.flip},$scope.rotate_background=function(){$scope.card.rotation=$scope.card.rotation&lt;3?++$scope.card.rotation:0},$scope.drag_background=function(){$scope.drag=!$scope.drag},$scope.randomize=function(){$scope.card.type=Math.random()&gt;=.5?&quot;burst&quot;:&quot;image&quot;,$scope.card.image=$scope.card.drop?$scope.card.drop.card_images[Math.floor(Math.random()*$scope.card.drop.card_images.length)]:&quot;&quot;,$scope.card.burst=$scope.bursts[Math.floor(Math.random()*$scope.bursts.length)],$scope.card.theme=$scope.themes[Math.floor(Math.random()*$scope.themes.length)],$scope.card.rotation=Math.floor(3*Math.random()),$scope.card.flip=Math.random()&gt;=.5,$scope.card.scale=Math.random()&gt;=.5}}]),angular.module(&quot;dropApp&quot;).controller(&quot;DropCtrl&quot;,[&quot;$scope&quot;,&quot;$routeParams&quot;,&quot;$timeout&quot;,&quot;$location&quot;,&quot;Api&quot;,function($scope,$routeParams,$timeout,$location,Api){function load_drop(){isNaN($routeParams.id)?Api.get_featured().then(render_drop):Api.get_drop($routeParams.id).then(render_drop)}function render_drop(drop){&quot;i&quot;===drop.dropped_at.charAt(0)||&quot;i&quot;===drop.dropped_at.charAt(5)?drop.dropped=!1:drop.dropped=!0,$scope.drop=drop,$scope.drop.album_uri=&quot;spotify:album:&quot;+$scope.drop.album_uri,$scope.drop.endpoint=&quot;http://open.spotify.com/&quot;+$scope.drop.album_uri.replace(&quot;spotify:&quot;,&quot;&quot;).replace(/:/g,&quot;/&quot;),$scope.spotify=&quot;/images/spotify.png&quot;;for(var i=$scope.drop.content.length;i--;i&gt;=0)$scope.drop.content[i].locked?$scope.drop.content.splice($scope.drop.content.length,0,$scope.drop.content.splice($scope.drop.content[i],1)[0]):$scope.items.unshift($scope.drop.content[i]);Api.get_ad().then(function(response){$scope.items.push(response)}),Api.get_cards().then(function(response){$scope.items.push(response[0])}),$timeout(function(){$scope.$broadcast(&quot;timer-start&quot;)},400),$scope.$on(&quot;$routeUpdate&quot;,$scope.on_route_update),$scope.on_route_update()}$scope.items=[],$scope.clickWatch=0,$scope.set_media=function(index){$location.search(&quot;media&quot;,index),$scope.clickWatch++},$scope.clear_media=function(){$(&quot;.youtube-player iframe&quot;).remove(),$location.url($location.path())},$scope.on_route_update=function(){$scope.media_index=$location.search().media,$scope.media=$scope.drop.content[$scope.media_index]},load_drop()}]),angular.module(&quot;dropApp&quot;).directive(&quot;audioPlayer&quot;,function(){return{scope:{uri:&quot;=audioPlayerUri&quot;,albumUri:&quot;=audioPlayerAlbumUri&quot;,revealDate:&quot;=audioPlayerRevealDate&quot;},link:function(scope,element){var base=&apos;&lt;iframe src=&quot;https://embed.spotify.com/?uri={uri}&quot; width=&quot;100%&quot; height=&quot;100%&quot; frameborder=&quot;0&quot; allowtransparency=&quot;true&quot;&gt;&lt;/iframe&gt;&apos;;scope.afterRelease=!1,scope.$watch(&quot;revealDate&quot;,function(){if(scope.revealDate){var revealDate=moment(scope.revealDate),currentDate=moment(),diff=currentDate.diff(revealDate,&quot;seconds&quot;);scope.afterRelease=diff&gt;0?!0:!1}}),scope.$watch(&quot;albumUri&quot;,function(){scope.afterRelease&amp;&amp;(scope.albumUri?(element.html(base.replace(&quot;{uri}&quot;,scope.albumUri)),setTimeout(function(){element.addClass(&quot;activated album&quot;)},500)):element.removeClass(&quot;activated&quot;))}),scope.$watch(&quot;uri&quot;,function(){scope.afterRelease||(scope.uri?(element.html(base.replace(&quot;{uri}&quot;,scope.uri)),setTimeout(function(){element.addClass(&quot;activated&quot;)},500)):element.removeClass(&quot;activated&quot;))})}}}),angular.module(&quot;dropApp&quot;).directive(&quot;slider&quot;,function(){return{scope:{options:&quot;=sliderOptions&quot;,switcher:&quot;=clickWatch&quot;},templateUrl:&quot;/partials/slider.html&quot;,transclude:!0,controller:[&quot;$scope&quot;,function($scope){this.initialize=function(){$scope.init()}}],link:function(scope,element){var defaults={grabCursor:!0,pagination:$(element).find(&quot;.swiper-pagination&quot;),nextButton:$(element).find(&quot;.swiper-button-next&quot;),prevButton:$(element).find(&quot;.swiper-button-prev&quot;),paginationClickable:!0,preloadImages:!1,lazyLoading:!0};scope.$watch(&quot;switcher&quot;,function(){$(&quot;.swiper-slide .swiper-lazy&quot;).each(function(idx){self=$(this),$(this).attr(&quot;src&quot;)&amp;&amp;(self.removeClass(&quot;swiper-lazy-loaded&quot;),self.removeAttr(&quot;src&quot;),setTimeout(function(){s.lazy.load()}))})});var s,options=angular.extend(defaults,scope.options);scope.init=function(){s&amp;&amp;s.destroy(),setTimeout(function(){s=new Swiper(element[0],options)},100)}}}}),angular.module(&quot;dropApp&quot;).directive(&quot;sliderItem&quot;,function(){return{require:&quot;^slider&quot;,link:function(scope,element,attrs,sliderCtrl){scope.$last&amp;&amp;sliderCtrl.initialize()}}}),angular.module(&quot;dropApp&quot;).directive(&quot;mediaCircle&quot;,function(){return{templateUrl:&quot;partials/media-circle.html&quot;,link:function(scope,element){var r=4*Math.random()+2.5,t=.25*Math.PI,labelX=r+r*Math.cos(t),labelY=r+r*Math.sin(t);scope.circleStyle={width:2*r+&quot;em&quot;,height:2*r+&quot;em&quot;},scope.labelStyle={top:labelY+&quot;em&quot;,left:labelX+&quot;em&quot;},setTimeout(function(){element.addClass(&quot;revealed&quot;)},200*scope.$index+1500)}}}),angular.module(&quot;dropApp&quot;).directive(&quot;imageLoader&quot;,function(){return{scope:{imageLoaderSrc:&quot;=imageLoaderSrc&quot;},template:&apos;&lt;div class=&quot;image-loader-element&quot; ng-style=&quot;backgroundImage&quot;&gt;&lt;/div&gt;&lt;div class=&quot;image-loader-progress&quot;&gt;&lt;/div&gt;&apos;,link:function(scope,element,attrs){function loadImage(){image=new Image,image.onload=onImageLoaded,image.src=scope.imageLoaderSrc,element.removeClass(&quot;image-loader-complete&quot;).addClass(&quot;image-loader-loading&quot;)}function onImageLoaded(){void 0!==attrs.backgroundImage&amp;&amp;scope.$emit(&quot;imageLoaded&quot;),element.removeClass(&quot;image-loader-loading&quot;).addClass(&quot;image-loader-complete&quot;).children().first().css(&quot;background-image&quot;,&quot;url(&quot;+scope.imageLoaderSrc+&quot;)&quot;)}function onImageError(){element.removeClass(&quot;image-loader-loading&quot;).removeClass(&quot;image-loader-complete&quot;)}var image;scope.$watch(&quot;imageLoaderSrc&quot;,function(val){val?setTimeout(function(){loadImage()},300):onImageError()})}}}),angular.module(&quot;dropApp&quot;).directive(&quot;gallery&quot;,function(){return{scope:{items:&quot;=galleryItems&quot;},templateUrl:&quot;partials/gallery.html&quot;,link:function(scope,element,attrs){scope.gallerySliderOptions={slidesPerView:1,pagination:&quot;.swiper-pagination&quot;,nextButton:&quot;.swiper-button-next&quot;,prevButton:&quot;.swiper-button-prev&quot;,paginationClickable:!0,preloadImages:!1,lazyLoading:!0,loop:!0}}}}),angular.module(&quot;dropApp&quot;).directive(&quot;youtubePlayer&quot;,[&quot;$sce&quot;,&quot;$timeout&quot;,function($sce,$timeout){return{scope:{data:&quot;=youtubePlayer&quot;},templateUrl:&quot;partials/videoplayer.html&quot;,link:function(scope,element,attrs){var id,base=&quot;http://www.youtube.com/embed/{id}?autoplay=1&amp;showinfo=0&amp;rel=0&amp;autohide=1&amp;showinfo=0&amp;enablejsapi=1&amp;playerapiid=ytplaye&quot;;scope.visible=!1,scope.$watch(&quot;data&quot;,function(){if(scope.data&amp;&amp;scope.data.content){if(!scope.data.content.url)return void scope.stop();id=scope.data.content.url.split(&quot;watch?v=&quot;)[1],$timeout(scope.play,500)}else scope.stop()}),scope.play=function(){scope.iframe_url=$sce.trustAsResourceUrl(base.replace(&quot;{id}&quot;,id)),scope.playing=!0},scope.stop=function(){scope.iframe_url=$sce.trustAsResourceUrl(&quot;about:blank&quot;),scope.playing=!1},window.uploadDone=function(){scope.data&amp;&amp;(scope.visible=!0,scope.$apply())}}}}]),angular.module(&quot;dropApp&quot;).directive(&quot;packery&quot;,function(){return{scope:!0,controller:[&quot;$scope&quot;,function($scope){this.initialize=function(){$scope.init()}}],link:function(scope,element,attrs){var p,defaults={itemSelector:&quot;.block-item&quot;,percentPosition:!0,masonry:{columnWidth:&quot;.block-item-small&quot;}};scope.init=function(){setTimeout(function(){p=new Isotope(element[0],defaults)},200),setTimeout(function(){p.arrange()},300)}}}}),angular.module(&quot;dropApp&quot;).directive(&quot;packeryItem&quot;,function(){return{require:&quot;^packery&quot;,link:function(scope,element,attrs,packeryCtrl){scope.$last&amp;&amp;packeryCtrl.initialize()}}}),angular.module(&quot;dropApp&quot;).directive(&quot;blockItem&quot;,function(){return{scope:{data:&quot;=blockItemData&quot;},template:&apos;&lt;div ng-include=&quot;get_template_url()&quot;&gt;&lt;/div&gt;&apos;,link:function(scope,element,attrs){function generate_media_cta(type){switch(type){case&quot;video&quot;:return&quot;watch now&quot;;case&quot;playlist&quot;:return&quot;listen&quot;;case&quot;single&quot;:return&quot;listen&quot;;case&quot;gallery&quot;:return&quot;view now&quot;;default:return&quot;view &quot;+type}}function get_image_url(id,files){return files[id]?files[id].url:null}function build_card(){switch(scope.data.type){case&quot;card&quot;:scope.template_url=&quot;partials/block-item-card.html&quot;,scope.cta=&quot;create your card&quot;,scope.image=get_image_url(scope.data.image_id,scope.data.files),element.addClass(&quot;block-item-small block-item-card&quot;);break;case&quot;ad&quot;:scope.template_url=&quot;partials/block-item-ad.html&quot;,scope.cta=&quot;listen now&quot;,element.addClass(&quot;block-item-small block-item-ad&quot;);break;case&quot;media&quot;:scope.template_url=&quot;partials/block-item-media.html&quot;,scope.cta=generate_media_cta(scope.data.media_type),element.addClass(&quot;video&quot;===scope.data.media_type?&quot;block-item-large&quot;:&quot;block-item-small&quot;);break;case&quot;drop&quot;:scope.template_url=&quot;partials/block-item-drop.html&quot;,scope.cta=&quot;view drop&quot;,element.addClass(&quot;block-item-small&quot;)}if(!scope.data.image&amp;&amp;!scope.data.featured_image){var random_drop_style=Math.floor(5*Math.random());element.addClass(&quot;drop-style-&quot;+random_drop_style)}}scope.$watch(&quot;data&quot;,function(val){val&amp;&amp;build_card()}),scope.get_template_url=function(){return scope.template_url},scope.is_playing=!1,scope.toggle_music=function(){scope.is_playing?(scope.is_playing=!1,element.removeClass(&quot;block-item-playing&quot;),scope.audio_uri=null):(scope.is_playing=!0,element.addClass(&quot;block-item-playing&quot;),scope.audio_uri=&quot;spotify:track:1XALSFY5nrFQ9NaI2XNp9t&quot;,console.log(&quot;playing&quot;))}}}}),angular.module(&quot;dropApp&quot;).directive(&quot;dropCard&quot;,[&quot;Image&quot;,&quot;Api&quot;,function(Image,Api){return{scope:!1,restrict:&quot;A&quot;,link:function(scope,element,attrs){function render_background(){var is_burst=&quot;burst&quot;===scope.card.type;background.onImageLoaded(function(){var img_data=background.getOriginalImageData();img_data=Image.duotone(img_data,scope.card.theme.background,scope.card.theme.foreground),img_data=scope.card.flip?Image.flipImage(img_data):img_data,background.setImageData(img_data),background.setRotation(is_burst?90*scope.card.rotation:0),background.update(!is_burst&amp;&amp;scope.card.scale?{w:900,h:900,x:-300,y:-300}:{w:450,h:450,x:-75,y:-75})}),card.background.update({fill:scope.card.theme.background}),background.changeURL(is_burst?scope.card.burst:scope.card.image)}function render_text(){return scope.card.track?(text.song.changeText(scope.card.track),text.songxs.changeText(&quot;&quot;),text.artist.changeText(scope.card.drop.album),text.song.w&gt;270?(text.song.changeText(&quot;&quot;),text.songxs.changeText(scope.card.track),format_text(&quot;small&quot;),text.songxs.w&gt;270&amp;&amp;text.songxs.truncate(270)):format_text(&quot;normal&quot;),void(text.artist.w&gt;200&amp;&amp;text.artist.truncate(200))):!1}function format_text(type){switch(type){case&quot;small&quot;:text.headline.update({y:100}),text.songxs.update({y:138}),text.from.update({y:170}),text.artist.update({y:170});break;default:text.headline.update({y:100}),text.song.update({y:145}),text.from.update({y:178}),text.artist.update({y:178})}for(var t in text)text[t].update({fill:scope.card.theme.text})}function render_user(){if(scope.card.user){var img=new window.Image;img.crossOrigin=&quot;Anonymous&quot;,img.onload=function(){var c=document.createElement(&quot;canvas&quot;),ctx=c.getContext(&quot;2d&quot;);ctx.beginPath(),ctx.arc(25,25,25,0,2*Math.PI,!0),ctx.closePath(),ctx.fill(),ctx.clip(),ctx.drawImage(this,0,0,50,50);var d=ctx.getImageData(0,0,50,50);avatar.setImageData(d),avatar.update({y:15})},img.src=scope.card.user.images[0].url,username.changeText(scope.card.user.display_name),username.update({y:35})}}function onMouseLeave(){is_dragging=!1}function onMouseDown(x,y){drag_position.x=x-background.x,drag_position.y=y-background.y,is_dragging=!0}function onMouseUp(){is_dragging=!1}function onMouseMove(x,y){if(is_dragging){var _x=x-drag_position.x,_y=y-drag_position.y;_x&gt;=-1?_x=-1:_x+background.w&lt;=card.width-1&amp;&amp;(_x=card.width-background.w+1),_y&gt;=-1?_y=-1:_y+background.h&lt;=card.height-1&amp;&amp;(_y=card.height-background.h+1),background.update({x:_x,y:_y})}}var card=new Postcard(element[0],{filename:&quot;dropcard.png&quot;}),background=card.addImage(&quot;background&quot;,&quot;&quot;),avatar=(card.addImage(&quot;bottomLogos&quot;,&quot;/images/bottomlogos.png&quot;,{x:0,y:260,w:300,h:40}),card.addImage(&quot;avatar&quot;,&quot;/images/sample-profile.png&quot;,{x:15,y:-45,w:35,h:35})),username=card.addText(&quot;username&quot;,&quot;&quot;,10,{x:58,y:-35,family:&quot;light&quot;,size:&quot;14px&quot;}),text={headline:card.addText(&quot;intro&quot;,&quot;I&apos;m feeling&quot;,10,{x:15,y:-15,family:&quot;light&quot;,size:&quot;20px&quot;}),song:card.addText(&quot;song&quot;,&quot;&quot;,10,{x:15,y:128,family:&quot;bold&quot;,size:&quot;40px&quot;}),songxs:card.addText(&quot;song.small&quot;,&quot;&quot;,10,{x:15,y:121,family:&quot;bold&quot;,size:&quot;30px&quot;}),from:card.addText(&quot;from&quot;,&quot;from&quot;,10,{x:15,y:-15,family:&quot;light&quot;,size:&quot;20px&quot;}),artist:card.addText(&quot;artist&quot;,&quot;&quot;,10,{x:63,y:-15,family:&quot;bold&quot;,size:&quot;20px&quot;}),cta:card.addText(&quot;cta&quot;,&quot;Album out now&quot;,10,{x:15,y:-15,family:&quot;light&quot;,size:&quot;15px&quot;})};scope.refresh=function(){scope.saved=!1,render_background(),render_text(),render_user()},scope.$watch(&quot;card&quot;,scope.refresh,!0),scope.randomize();var is_dragging=!1,drag_position={};scope.$watch(&quot;drag&quot;,function(){scope.drag?(element.css(&quot;cursor&quot;,&quot;move&quot;).bind(&quot;mouseleave&quot;,onMouseLeave),card.onMouseDown(onMouseDown),card.onMouseUp(onMouseUp),card.onMouseMove(onMouseMove)):(element.css(&quot;cursor&quot;,&quot;auto&quot;),card.clearMouseEvents())}),scope.save=function(){Api.save_card(scope.card,card[&quot;export&quot;]()).then(function(response){scope.saved=!0,Api.get_single_card(response).then(function(data){scope.imageUrl=encodeURIComponent(data.files[data.image_id].url)})})},scope.download=function(event){card.save(event)},PostcardTextObject.prototype.truncate=function(width){for(var t=this.text,i=0;this.w&gt;width;)this.changeText(t.substr(0,t.length-++i)+&quot;...&quot;)}}}}]),angular.module(&quot;dropApp&quot;).directive(&quot;mediaIcon&quot;,function(){return{scope:{media:&quot;=mediaIcon&quot;},link:function(scope,element,attrs){scope.$watch(&quot;media&quot;,function(){if(element.removeClass(),scope.media.locked)element.replaceWith(&apos;&lt;div class=&quot;exlusive-video&quot;&gt;&lt;img src=&quot;/images/icons/Locked-white.svg&quot;&gt;&lt;span&gt;Locked Content&lt;/span&gt;&lt;/div&gt;&apos;);else switch(scope.media.media_type){case&quot;video&quot;:element.replaceWith(&apos;&lt;div class=&quot;exlusive-video&quot;&gt;&lt;img src=&quot;/images/icons/Video-white.svg&quot;&gt;&lt;span&gt;Exclusive Video&lt;/span&gt;&lt;/div&gt;&apos;);break;case&quot;playlist&quot;:element.replaceWith(&apos;&lt;div class=&quot;exlusive-video&quot;&gt;&lt;img src=&quot;/images/icons/Playlist-white.svg&quot;&gt;&lt;span&gt;Exclusive Playlist&lt;/span&gt;&lt;/div&gt;&apos;);break;case&quot;single&quot;:element.addClass(&quot;fa fa-play&quot;);break;case&quot;gallery&quot;:element.replaceWith(&apos;&lt;div class=&quot;exlusive-video&quot;&gt;&lt;img src=&quot;/images/icons/Gallery-white.svg&quot;&gt;&lt;span&gt;Exclusive Gallery&lt;/span&gt;&lt;/div&gt;&apos;)}})}}})</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/leif/Dropbox/Software3308-Group1/FinalSubmission/GeoReport/scripts/scripts.js" line="1" column="1" bodyfile="/home/leif/Dropbox/Software3308-Group1/FinalSubmission/GeoReport/scripts/scripts.js" bodystart="1" bodyend="-1"/>
      </memberdef>
      </sectiondef>
      <sectiondef kind="func">
      <memberdef kind="function" id="scripts_2scripts_8js_1a4054c9e368975600b943bb623de86970" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>angular</type>
        <definition>angular module</definition>
        <argsstring>(&quot;dropApp&quot;,[&quot;ngCookies&quot;,&quot;ngResource&quot;,&quot;ngRoute&quot;,&quot;ngSanitize&quot;,&quot;ngProgress&quot;,&quot;timer&quot;,&quot;infinite-scroll&quot;]).config([&quot;$routeProvider&quot;</argsstring>
        <name>module</name>
        <param>
          <type>&quot;dropApp&quot;</type>
          <defname>&quot;dropApp&quot;</defname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/leif/Dropbox/Software3308-Group1/FinalSubmission/GeoReport/scripts/scripts.js" line="1" column="1"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="stringliteral">&quot;use<sp/>strict&quot;</highlight><highlight class="normal">;var<sp/>resolve={delay:</highlight><highlight class="keyword">function</highlight><highlight class="normal">(<ref refid="getrss_8php_1abb0f8f809252372e25f48d52b63ef29d" kindref="member">$q</ref>,$timeout){var<sp/>delay=<ref refid="getrss_8php_1abb0f8f809252372e25f48d52b63ef29d" kindref="member">$q</ref>.defer();</highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$timeout(delay.resolve,0,!1),delay.promise}};angular.module(</highlight><highlight class="stringliteral">&quot;dropApp&quot;</highlight><highlight class="normal">,[</highlight><highlight class="stringliteral">&quot;ngCookies&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;ngResource&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;ngRoute&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;ngSanitize&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;ngProgress&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;timer&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;infinite-scroll&quot;</highlight><highlight class="normal">]).config([</highlight><highlight class="stringliteral">&quot;$routeProvider&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;$locationProvider&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;$httpProvider&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">($routeProvider,$locationProvider,$httpProvider){$routeProvider.when(</highlight><highlight class="stringliteral">&quot;/&quot;</highlight><highlight class="normal">,{templateUrl:</highlight><highlight class="stringliteral">&quot;views/main.html&quot;</highlight><highlight class="normal">,controller:</highlight><highlight class="stringliteral">&quot;MainCtrl&quot;</highlight><highlight class="normal">,resolve:resolve}).when(</highlight><highlight class="stringliteral">&quot;/all&quot;</highlight><highlight class="normal">,{templateUrl:</highlight><highlight class="stringliteral">&quot;views/all.html&quot;</highlight><highlight class="normal">,controller:</highlight><highlight class="stringliteral">&quot;AllCtrl&quot;</highlight><highlight class="normal">,resolve:resolve}).when(</highlight><highlight class="stringliteral">&quot;/create&quot;</highlight><highlight class="normal">,{templateUrl:</highlight><highlight class="stringliteral">&quot;views/create.html&quot;</highlight><highlight class="normal">,controller:</highlight><highlight class="stringliteral">&quot;CreateCtrl&quot;</highlight><highlight class="normal">,resolve:resolve}).when(</highlight><highlight class="stringliteral">&quot;/featured&quot;</highlight><highlight class="normal">,{templateUrl:</highlight><highlight class="stringliteral">&quot;views/drop.html&quot;</highlight><highlight class="normal">,controller:</highlight><highlight class="stringliteral">&quot;DropCtrl&quot;</highlight><highlight class="normal">,reloadOnSearch:!1,resolve:resolve}).when(</highlight><highlight class="stringliteral">&quot;/drop/:id&quot;</highlight><highlight class="normal">,{templateUrl:</highlight><highlight class="stringliteral">&quot;views/drop.html&quot;</highlight><highlight class="normal">,controller:</highlight><highlight class="stringliteral">&quot;DropCtrl&quot;</highlight><highlight class="normal">,reloadOnSearch:!1,resolve:resolve}).otherwise({redirectTo:</highlight><highlight class="stringliteral">&quot;/&quot;</highlight><highlight class="normal">}),$httpProvider.defaults.headers.post[</highlight><highlight class="stringliteral">&quot;Content-Type&quot;</highlight><highlight class="normal">]=</highlight><highlight class="stringliteral">&quot;application/x-www-form-urlencoded;charset=utf-8&quot;</highlight><highlight class="normal">;var<sp/>param=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(obj){var<sp/>name,value,fullSubName,subName,subValue,innerObj,i,query=</highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">;</highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(name<sp/>in<sp/>obj)</highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(value=obj[name],value<sp/>instanceof<sp/>Array)</highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(i=0;i&lt;value.length;++i)subValue=value[i],fullSubName=name+</highlight><highlight class="stringliteral">&quot;[&quot;</highlight><highlight class="normal">+i+</highlight><highlight class="stringliteral">&quot;]&quot;</highlight><highlight class="normal">,innerObj={},innerObj[fullSubName]=subValue,query+=param(innerObj)+</highlight><highlight class="stringliteral">&quot;&amp;&quot;</highlight><highlight class="normal">;</highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(value<sp/>instanceof<sp/>Object)</highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(subName<sp/>in<sp/>value)subValue=value[subName],fullSubName=name+</highlight><highlight class="stringliteral">&quot;[&quot;</highlight><highlight class="normal">+subName+</highlight><highlight class="stringliteral">&quot;]&quot;</highlight><highlight class="normal">,innerObj={},innerObj[fullSubName]=subValue,query+=param(innerObj)+</highlight><highlight class="stringliteral">&quot;&amp;&quot;</highlight><highlight class="normal">;</highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>0!==value&amp;&amp;null!==value&amp;&amp;(query+=encodeURIComponent(name)+</highlight><highlight class="stringliteral">&quot;=&quot;</highlight><highlight class="normal">+encodeURIComponent(value)+</highlight><highlight class="stringliteral">&quot;&amp;&quot;</highlight><highlight class="normal">);</highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>query.length?query.substr(0,query.length-1):query};$httpProvider.defaults.transformRequest=[</highlight><highlight class="keyword">function</highlight><highlight class="normal">(data){</highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>angular.isObject(data)&amp;&amp;</highlight><highlight class="stringliteral">&quot;[object<sp/>File]&quot;</highlight><highlight class="normal">!==String(data)?param(data):data}]}]).run([</highlight><highlight class="stringliteral">&quot;$rootScope&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;$location&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;$route&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;$timeout&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;Spotify&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;ngProgress&quot;</highlight><highlight class="normal">,function($rootScope,$location,$route,$timeout,Spotify,ngProgress){var<sp/>token_key=</highlight><highlight class="stringliteral">&quot;access_token=&quot;</highlight><highlight class="normal">,token_index=window.location.href.indexOf(token_key);</highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(token_index&gt;-1){var<sp/>token=window.location.href.substr(token_index+token_key.length).split(</highlight><highlight class="stringliteral">&quot;&amp;&quot;</highlight><highlight class="normal">)[0];Spotify.set_access_token(token),$location.path(</highlight><highlight class="stringliteral">&quot;/create&quot;</highlight><highlight class="normal">)}var<sp/>oldLocation=</highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">;$rootScope.$on(</highlight><highlight class="stringliteral">&quot;$routeChangeStart&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">(angularEvent,next){$rootScope.view_class=</highlight><highlight class="stringliteral">&quot;view-&quot;</highlight><highlight class="normal">+$location.path().substr(1),ngProgress.reset();var<sp/>isForwards=!0;</highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(next&amp;&amp;next.$$route){var<sp/>newLocation=next.$$route.originalPath;oldLocation!==newLocation&amp;&amp;-1!==oldLocation.indexOf(newLocation)&amp;&amp;(isForwards=!1),oldLocation=newLocation}}),ngProgress.color(</highlight><highlight class="stringliteral">&quot;#16e58a&quot;</highlight><highlight class="normal">)}]),angular.module(</highlight><highlight class="stringliteral">&quot;dropApp&quot;</highlight><highlight class="normal">).service(</highlight><highlight class="stringliteral">&quot;Image&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){</highlight><highlight class="keyword">function</highlight><highlight class="normal"><sp/>hexToRgb(hex){var<sp/>result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);</highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>result?{r:parseInt(result[1],16),g:parseInt(result[2],16),b:parseInt(result[3],16)}:null}this.grayscale=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(pixels){</highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(var<sp/>d=pixels.data,i=0;i&lt;d.length;i+=4){var<sp/>r=d[i],g=d[i+1],b=d[i+2],v=.2126*r+.7152*g+.0722*b;d[i]=d[i+1]=d[i+2]=v}</highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>pixels},this.duotone=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(img,tone1,tone2){var<sp/>gradient=this.gradientMap(tone1,tone2);img=this.grayscale(img);</highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(var<sp/>d=img.data,i=0;i&lt;d.length;i+=4)d[i]=gradient[4*d[i]],d[i+1]=gradient[4*d[i+1]+1],d[i+2]=gradient[4*d[i+2]+2];</highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>img},this.gradientMap=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(tone1,tone2){</highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(var<sp/>rgb1=hexToRgb(tone1),rgb2=hexToRgb(tone2),gradient=[],i=0;1024&gt;i;i+=4)gradient[i]=((256-i/4)*rgb1.r+i/4*rgb2.r)/256,gradient[i+1]=((256-i/4)*rgb1.g+i/4*rgb2.g)/256,gradient[i+2]=((256-i/4)*rgb1.b+i/4*rgb2.b)/256,gradient[i+3]=255;</highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>gradient},this.flipImage=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(input){</highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(var<sp/>tempCtx=document.createElement(</highlight><highlight class="stringliteral">&quot;canvas&quot;</highlight><highlight class="normal">).getContext(</highlight><highlight class="stringliteral">&quot;2d&quot;</highlight><highlight class="normal">),output=tempCtx.createImageData(input.width,input.height),w=input.width,h=input.height,inputData=input.data,outputData=output.data,y=1;h-1&gt;y;y+=1)</highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(var<sp/>x=1;w-1&gt;x;x+=1)</highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(var<sp/>i=4*(y*w+x),flip=4*(y*w+(w-x)),c=0;4&gt;c;c+=1)outputData[i+c]=inputData[flip+c];</highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>output}}),angular.module(</highlight><highlight class="stringliteral">&quot;dropApp&quot;</highlight><highlight class="normal">).service(</highlight><highlight class="stringliteral">&quot;BlockFormatter&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){this.format_media=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(media,parent){var<sp/>block={};</highlight><highlight class="keywordflow">switch</highlight><highlight class="normal">(block.type=</highlight><highlight class="stringliteral">&quot;media&quot;</highlight><highlight class="normal">,block.media_type=media.drop_type,block.title=media.title?media.title:</highlight><highlight class="stringliteral">&quot;Check<sp/>out<sp/>this<sp/>exclusive<sp/>&quot;</highlight><highlight class="normal">+media.drop_type+</highlight><highlight class="stringliteral">&quot;!&quot;</highlight><highlight class="normal">,block.description=media.description?media.description:</highlight><highlight class="stringliteral">&quot;Love<sp/>&quot;</highlight><highlight class="normal">+parent.name+</highlight><highlight class="stringliteral">&quot;?<sp/>Don&apos;t<sp/>miss<sp/>this!&quot;</highlight><highlight class="normal">,block.url=</highlight><highlight class="stringliteral">&quot;/drop/&quot;</highlight><highlight class="normal">+media.artist_id+</highlight><highlight class="stringliteral">&quot;?media=&quot;</highlight><highlight class="normal">+media.id,media.drop_type){</highlight><highlight class="keywordflow">case</highlight><highlight class="stringliteral">&quot;video&quot;</highlight><highlight class="normal">:block.call_to_action=</highlight><highlight class="stringliteral">&quot;watch<sp/>now&quot;</highlight><highlight class="normal">;</highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight><highlight class="keywordflow">case</highlight><highlight class="stringliteral">&quot;gallery&quot;</highlight><highlight class="normal">:block.call_to_action=</highlight><highlight class="stringliteral">&quot;gallery&quot;</highlight><highlight class="normal">;</highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight><highlight class="keywordflow">case</highlight><highlight class="stringliteral">&quot;playlist&quot;</highlight><highlight class="normal">:block.call_to_action=</highlight><highlight class="stringliteral">&quot;follow&quot;</highlight><highlight class="normal">}</highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>block},this.format_drop=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(data){var<sp/>block={};</highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>block.type=</highlight><highlight class="stringliteral">&quot;drop&quot;</highlight><highlight class="normal">,block.title=data.name,block.image=data.files[data.featured_image_id].url,block.url=</highlight><highlight class="stringliteral">&quot;/drop/&quot;</highlight><highlight class="normal">+data.id,block.call_to_action=</highlight><highlight class="stringliteral">&quot;view<sp/>drop&quot;</highlight><highlight class="normal">,block}}),angular.module(</highlight><highlight class="stringliteral">&quot;dropApp&quot;</highlight><highlight class="normal">).service(</highlight><highlight class="stringliteral">&quot;Spotify&quot;</highlight><highlight class="normal">,[</highlight><highlight class="stringliteral">&quot;$http&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;$location&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;$window&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;$q&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">($http,$location,$window,<ref refid="getrss_8php_1abb0f8f809252372e25f48d52b63ef29d" kindref="member">$q</ref>){var<sp/>access_token,user,client_id=</highlight><highlight class="stringliteral">&quot;d8c2bf8b2663462e93004f0575f821e8&quot;</highlight><highlight class="normal">,redirect_uri=</highlight><highlight class="stringliteral">&quot;http://spotify-thedrop.com/&quot;</highlight><highlight class="normal">,authorization_url=</highlight><highlight class="stringliteral">&quot;https://accounts.spotify.com/authorize&quot;</highlight><highlight class="normal">,api_base=</highlight><highlight class="stringliteral">&quot;https://api.spotify.com/v1&quot;</highlight><highlight class="normal">;this.set_access_token=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(token){access_token=token},this.get_access_token=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){</highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>access_token},this.authenticate=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){var<sp/>url_string=authorization_url+</highlight><highlight class="stringliteral">&quot;?response_type=token&amp;client_id=&quot;</highlight><highlight class="normal">+client_id+</highlight><highlight class="stringliteral">&quot;&amp;redirect_uri=&quot;</highlight><highlight class="normal">+redirect_uri;$window.location.href=url_string},this.get_user=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){var<sp/>deferred=<ref refid="getrss_8php_1abb0f8f809252372e25f48d52b63ef29d" kindref="member">$q</ref>.defer();</highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>user?deferred.resolve(user):$http({url:api_base+</highlight><highlight class="stringliteral">&quot;/me&quot;</highlight><highlight class="normal">,headers:{Authorization:</highlight><highlight class="stringliteral">&quot;Bearer<sp/>&quot;</highlight><highlight class="normal">+access_token}}).success(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(response){deferred.resolve(user=response)}).error(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(response){deferred.reject()}),deferred.promise}}]),angular.module(</highlight><highlight class="stringliteral">&quot;dropApp&quot;</highlight><highlight class="normal">).service(</highlight><highlight class="stringliteral">&quot;Api&quot;</highlight><highlight class="normal">,[</highlight><highlight class="stringliteral">&quot;$http&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;$q&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">($http,<ref refid="getrss_8php_1abb0f8f809252372e25f48d52b63ef29d" kindref="member">$q</ref>){</highlight><highlight class="keyword">function</highlight><highlight class="normal"><sp/>card_shim(raw){</highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(var<sp/>i=0;i&lt;raw.length;i++)raw[i].type=</highlight><highlight class="stringliteral">&quot;card&quot;</highlight><highlight class="normal">;</highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>raw}</highlight><highlight class="keyword">function</highlight><highlight class="normal"><sp/>drop_shim(data){</highlight><highlight class="keyword">function</highlight><highlight class="normal"><sp/>get_image_url(</highlight><highlight class="keywordtype">id</highlight><highlight class="normal">){</highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>data.files[id]?data.files[id].url:null}</highlight><highlight class="keyword">function</highlight><highlight class="normal"><sp/>get_image_content_url(i,</highlight><highlight class="keywordtype">id</highlight><highlight class="normal">){</highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>data.content[i].files[id]?data.content[i].files[id].url:null}var<sp/>now=(</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Date).getTime();data.type=</highlight><highlight class="stringliteral">&quot;drop&quot;</highlight><highlight class="normal">,data.featured_image=get_image_url(data.featured_image_id),data.header_image=get_image_url(data.header_image_id),data.dropped_at=moment(data.reveal_date).fromNow(),data.single_uri=</highlight><highlight class="stringliteral">&quot;spotify:track:&quot;</highlight><highlight class="normal">+data.single,data.dropped=moment(data.release_date).isAfter(now),</highlight><highlight class="stringliteral">&quot;i&quot;</highlight><highlight class="normal">===data.dropped_at.charAt(0)&amp;&amp;</highlight><highlight class="stringliteral">&quot;n&quot;</highlight><highlight class="normal">===data.dropped_at.charAt(1)?data.dropped_at=</highlight><highlight class="stringliteral">&quot;Dropping<sp/>&quot;</highlight><highlight class="normal">+data.dropped_at:data.dropped_at=</highlight><highlight class="stringliteral">&quot;Dropped<sp/>&quot;</highlight><highlight class="normal">+data.dropped_at,data.card_images=[];var<sp/>card_image_1=get_image_url(data.artist_image1_id),card_image_2=get_image_url(data.artist_image2_id),card_image_3=get_image_url(data.artist_image3_id);</highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(card_image_1&amp;&amp;data.card_images.push(card_image_1),card_image_2&amp;&amp;data.card_images.push(card_image_2),card_image_3&amp;&amp;data.card_images.push(card_image_3),data.content)</highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(var<sp/>i=0;i&lt;data.content.length;i++){var<sp/>content=data.content[i];content.item_index=i,content.type=</highlight><highlight class="stringliteral">&quot;media&quot;</highlight><highlight class="normal">,content.media_type=content.content_type,content.media_index=i,content.featured_image=get_image_content_url(i,content.featured_image_id),content.dropped_at=moment(content.release_date).fromNow(),content.drop_id=data.id,content.locked=moment(content.release_date).isAfter(now)}</highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>data}var<sp/>drops,cards,base=</highlight><highlight class="stringliteral">&quot;http://spotify-thedrop-api.herokuapp.com&quot;</highlight><highlight class="normal">;this.get_drop=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(id){var<sp/>deferred=<ref refid="getrss_8php_1abb0f8f809252372e25f48d52b63ef29d" kindref="member">$q</ref>.defer();</highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$http.get(base+</highlight><highlight class="stringliteral">&quot;/drop/&quot;</highlight><highlight class="normal">+</highlight><highlight class="keywordtype">id</highlight><highlight class="normal">+</highlight><highlight class="stringliteral">&quot;/&quot;</highlight><highlight class="normal">).success(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(response){deferred.resolve(drop_shim(response))}),deferred.promise},this.get_all_drops=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){var<sp/>deferred=<ref refid="getrss_8php_1abb0f8f809252372e25f48d52b63ef29d" kindref="member">$q</ref>.defer();</highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>drops?deferred.resolve(drops):$http.get(base+</highlight><highlight class="stringliteral">&quot;/drops&quot;</highlight><highlight class="normal">).success(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(response){</highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(var<sp/>i=0;i&lt;response.length;i++)response[i]=drop_shim(response[i]);deferred.resolve(drops=response)}),deferred.promise},this.get_featured=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){var<sp/>deferred=<ref refid="getrss_8php_1abb0f8f809252372e25f48d52b63ef29d" kindref="member">$q</ref>.defer();</highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$http.get(base+</highlight><highlight class="stringliteral">&quot;/drops?featured=1&quot;</highlight><highlight class="normal">).success(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(response){deferred.resolve(drop_shim(response[response.length-1]))}),deferred.promise},this.get_cards=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){var<sp/>deferred=<ref refid="getrss_8php_1abb0f8f809252372e25f48d52b63ef29d" kindref="member">$q</ref>.defer();</highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>cards?deferred.resolve(cards):$http.get(base+</highlight><highlight class="stringliteral">&quot;/cards?featured=1/&quot;</highlight><highlight class="normal">).success(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(response){cards=card_shim(response),deferred.resolve(cards)}),deferred.promise},this.get_single_card=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(route){var<sp/>deferred=<ref refid="getrss_8php_1abb0f8f809252372e25f48d52b63ef29d" kindref="member">$q</ref>.defer();</highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>cards?deferred.resolve(cards):$http.get(route).success(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(response){deferred.resolve(response)}),deferred.promise},this.get_ad=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){var<sp/>deferred=<ref refid="getrss_8php_1abb0f8f809252372e25f48d52b63ef29d" kindref="member">$q</ref>.defer();</highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$http.get(base+</highlight><highlight class="stringliteral">&quot;/api/brands_list&quot;</highlight><highlight class="normal">).success(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(response){var<sp/>latestResponse=response[response.length-1];latestResponse.type=</highlight><highlight class="stringliteral">&quot;ad&quot;</highlight><highlight class="normal">,latestResponse.image=latestResponse.files[latestResponse.image_id].url,deferred.resolve(latestResponse)}),deferred.promise},this.save_card=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(card_data,image){var<sp/>deferred=<ref refid="getrss_8php_1abb0f8f809252372e25f48d52b63ef29d" kindref="member">$q</ref>.defer(),data={drop_id:card_data.drop.id,creator_id:card_data.user.id,image:image};</highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$http({method:</highlight><highlight class="stringliteral">&quot;POST&quot;</highlight><highlight class="normal">,url:base+</highlight><highlight class="stringliteral">&quot;/card/&quot;</highlight><highlight class="normal">,data:data,headers:{</highlight><highlight class="stringliteral">&quot;Content-Type&quot;</highlight><highlight class="normal">:</highlight><highlight class="stringliteral">&quot;application/x-www-form-urlencoded&quot;</highlight><highlight class="normal">}}).success(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(response,status,headers,config){deferred.resolve(</highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">+base+headers().location)}),deferred.promise}}]),angular.module(</highlight><highlight class="stringliteral">&quot;dropApp&quot;</highlight><highlight class="normal">).controller(</highlight><highlight class="stringliteral">&quot;MainCtrl&quot;</highlight><highlight class="normal">,[</highlight><highlight class="stringliteral">&quot;$scope&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;$timeout&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;$q&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;$location&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;Api&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;ngProgress&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">($scope,$timeout,<ref refid="getrss_8php_1abb0f8f809252372e25f48d52b63ef29d" kindref="member">$q</ref>,$location,Api,ngProgress){$scope.items=[];var<sp/>featured=2;$scope.selectFeature=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(setFeature){featured=setFeature},$scope.isFeatured=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(checkFeature){</highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>featured===checkFeature},this.load_featured_drop=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){Api.get_featured().then(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(response){ngProgress.complete(),$scope.featured=response,$scope.$on(</highlight><highlight class="stringliteral">&quot;imageLoaded&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){$timeout(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){$scope.backgroundLoaded=!0,$scope.firstLoad=!0;media:</highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(var<sp/>i=$scope.featured.content.length;i--;i&gt;=0)</highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!$scope.featured.content[i].locked){$scope.items.unshift($scope.featured.content[i]),$scope.items[0].name=$scope.featured.name,$timeout(function(){$scope.firstLoad=!1},1e3);</highlight><highlight class="keywordflow">break</highlight><highlight class="normal"><sp/>media}$timeout(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){Api.get_ad().then(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(response){$scope.items.push(response)}),$scope.ready=!0},1600)},700)})})};var<sp/>random_drops,random_cards;$scope.load_random_assets=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){ngProgress.start(),<ref refid="getrss_8php_1abb0f8f809252372e25f48d52b63ef29d" kindref="member">$q</ref>.all([Api.get_all_drops(),Api.get_cards()]).then(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(response){ngProgress.complete(),random_drops=angular.copy(response[0]),random_cards=angular.copy(response[1]),$scope.add_random_assets()})},$scope.add_random_assets=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){</highlight><highlight class="keywordflow">if</highlight><highlight class="normal">($scope.ready=!1,!random_drops||!random_drops.length)</highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$scope.load_random_assets(),!1;</highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(var<sp/>random_items=[],random_index=Math.floor(Math.random()*(random_drops.length-4)),random_range=random_drops.splice(random_index,5),i=0;i&lt;random_range.length;i++){var<sp/>selected_drop=random_range[i],selected_drop_media_length=selected_drop.content?selected_drop.content.length:0,selected_random_index=Math.floor(Math.random()*(selected_drop_media_length+1));selected_random_index===selected_drop_media_length?random_items.push(selected_drop):(selected_drop.content[selected_random_index].name=selected_drop.name,random_items.push(selected_drop.content[selected_random_index]))}</highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(random_cards.length){var<sp/>random_card_index=Math.floor(Math.random()*(random_items.length-1));random_items.splice(random_card_index,0,random_cards.pop())}$scope.items=$scope.items.concat(random_items),$scope.ready=!0},this.load_featured_drop()}]),angular.module(</highlight><highlight class="stringliteral">&quot;dropApp&quot;</highlight><highlight class="normal">).controller(</highlight><highlight class="stringliteral">&quot;HeaderCtrl&quot;</highlight><highlight class="normal">,[</highlight><highlight class="stringliteral">&quot;$scope&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;$location&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">($scope,$location){$scope.links=[{title:</highlight><highlight class="stringliteral">&quot;FEATURED&quot;</highlight><highlight class="normal">,path:</highlight><highlight class="stringliteral">&quot;/drop/featured&quot;</highlight><highlight class="normal">},{title:</highlight><highlight class="stringliteral">&quot;ALL&quot;</highlight><highlight class="normal">,path:</highlight><highlight class="stringliteral">&quot;/all&quot;</highlight><highlight class="normal">},{title:</highlight><highlight class="stringliteral">&quot;CREATE&quot;</highlight><highlight class="normal">,path:</highlight><highlight class="stringliteral">&quot;/create&quot;</highlight><highlight class="normal">}],$scope.visisble=!0,$scope.toggleShare=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(toggle){var<sp/>$shareButtons=$(</highlight><highlight class="stringliteral">&quot;.share-button&quot;</highlight><highlight class="normal">),buttonsNum=$shareButtons.length,buttonsMid=buttonsNum/3,spacing=90;$scope.visisble&amp;&amp;</highlight><highlight class="stringliteral">&quot;close&quot;</highlight><highlight class="normal">!==toggle?($shareButtons.each(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(i){var<sp/>$cur=$(this),pos=i-1,dist=Math.abs(pos);$cur.css({zIndex:buttonsMid-dist}),TweenMax.to($cur,1.1*dist,{x:pos*spacing,y:90,scale:.95,width:60,height:60,ease:Elastic.easeOut,easeParams:[1.01,.5]}),TweenMax.to($cur,.8,{delay:.2*dist-.1,scale:.95,width:60,height:60,ease:Elastic.easeOut,easeParams:[1.1,.6]}),TweenMax.fromTo($cur.children(</highlight><highlight class="stringliteral">&quot;.share-icon&quot;</highlight><highlight class="normal">),.2,{scale:0},{delay:.2*dist-.1,scale:1,ease:Quad.easeInOut})}),$scope.visisble=!$scope.visisble):</highlight><highlight class="stringliteral">&quot;close&quot;</highlight><highlight class="normal">===toggle?($shareButtons.each(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(i){var<sp/>$cur=$(this),pos=i,dist=Math.abs(pos);$cur.css({zIndex:dist}),TweenMax.to($cur,.4+.1*(buttonsMid-dist),{x:0,y:0,scale:0,width:32,height:32,ease:Quad.easeInOut}),TweenMax.to($cur.children(</highlight><highlight class="stringliteral">&quot;.share-icon&quot;</highlight><highlight class="normal">),.2,{scale:0,ease:Quad.easeIn})}),$scope.visisble=!0):($shareButtons.each(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(i){var<sp/>$cur=$(this),pos=i,dist=Math.abs(pos);$cur.css({zIndex:dist}),TweenMax.to($cur,.4+.1*(buttonsMid-dist),{x:0,y:0,scale:0,width:32,height:32,ease:Quad.easeInOut}),TweenMax.to($cur.children(</highlight><highlight class="stringliteral">&quot;.share-icon&quot;</highlight><highlight class="normal">),.2,{scale:0,ease:Quad.easeIn})}),$scope.visisble=!0)},$scope.$on(</highlight><highlight class="stringliteral">&quot;$locationChangeSuccess&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">(e,next){$scope.path=$location.path(),$scope.toggleShare(</highlight><highlight class="stringliteral">&quot;close&quot;</highlight><highlight class="normal">)}),$scope.path=$location.path()}]),angular.module(</highlight><highlight class="stringliteral">&quot;dropApp&quot;</highlight><highlight class="normal">).controller(</highlight><highlight class="stringliteral">&quot;FeaturedCtrl&quot;</highlight><highlight class="normal">,[</highlight><highlight class="stringliteral">&quot;$scope&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;$timeout&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;$q&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;$location&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;Api&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;ngProgress&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">($scope,$timeout,<ref refid="getrss_8php_1abb0f8f809252372e25f48d52b63ef29d" kindref="member">$q</ref>,$location,Api,ngProgress){$scope.items=[],this.load_featured_drop=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){ngProgress.start(),Api.get_featured().then(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(response){ngProgress.complete(),$timeout(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){$scope.featured=response;media:</highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(var<sp/>i=$scope.quantity;i--;i&gt;=0)</highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!$scope.featured.content[i].locked){$scope.items.unshift($scope.featured.content[i]);break<sp/>media}Api.get_ad().then(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(response){$scope.items.push(response)}),$scope.ready=!0},500)})};var<sp/>random_drops,random_cards;$scope.load_random_assets=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){ngProgress.start(),<ref refid="getrss_8php_1abb0f8f809252372e25f48d52b63ef29d" kindref="member">$q</ref>.all([Api.get_all_drops(),Api.get_cards()]).then(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(response){ngProgress.complete(),random_drops=angular.copy(response[0]),random_cards=angular.copy(response[1]),$scope.add_random_assets()})},$scope.add_random_assets=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){</highlight><highlight class="keywordflow">if</highlight><highlight class="normal">($scope.ready=!1,!random_drops||!random_drops.length)</highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$scope.load_random_assets(),!1;</highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(var<sp/>random_items=[],random_index=Math.floor(Math.random()*(random_drops.length-4)),random_range=random_drops.splice(random_index,5),i=0;i&lt;random_range.length;i++){var<sp/>selected_drop=random_range[i],selected_drop_media_length=selected_drop.content?selected_drop.content.length:0,selected_random_index=Math.floor(Math.random()*(selected_drop_media_length+1));selected_random_index===selected_drop_media_length?random_items.push(selected_drop):random_items.push(selected_drop.content[selected_random_index])}</highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(random_cards.length){var<sp/>random_card_index=Math.floor(Math.random()*(random_items.length-1));random_items.splice(random_card_index,0,random_cards.pop())}$scope.items=$scope.items.concat(random_items),$scope.ready=!0},this.load_featured_drop()}]),angular.module(</highlight><highlight class="stringliteral">&quot;dropApp&quot;</highlight><highlight class="normal">).controller(</highlight><highlight class="stringliteral">&quot;AllCtrl&quot;</highlight><highlight class="normal">,[</highlight><highlight class="stringliteral">&quot;$scope&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;$timeout&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;Api&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;ngProgress&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">($scope,$timeout,Api,ngProgress){$scope.limit=6,$scope.limit_per_page=6,$scope.visible=!1,this.load_drops=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){ngProgress.start(),Api.get_all_drops().then(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(response){ngProgress.complete(),$timeout(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){$scope.drops=response.reverse(),$scope.visible=!0},500)})},$scope.background=</highlight><highlight class="stringliteral">&quot;/images/auth/all.jpg&quot;</highlight><highlight class="normal">,$scope.next_page=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){$scope.limit=$scope.limit+$scope.limit_per_page},this.load_drops()}]),angular.module(</highlight><highlight class="stringliteral">&quot;dropApp&quot;</highlight><highlight class="normal">).controller(</highlight><highlight class="stringliteral">&quot;CreateCtrl&quot;</highlight><highlight class="normal">,[</highlight><highlight class="stringliteral">&quot;$scope&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;$q&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;$timeout&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;Api&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;Spotify&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;ngProgress&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">($scope,<ref refid="getrss_8php_1abb0f8f809252372e25f48d52b63ef29d" kindref="member">$q</ref>,$timeout,Api,Spotify,ngProgress){$scope.card={},$scope.imageUrl=</highlight><highlight class="stringliteral">&quot;spotify-thedrop.com&quot;</highlight><highlight class="normal">,$scope.auth_blocked=!Spotify.get_access_token(),$scope.auth_blocked||(ngProgress.start(),$scope.auth_blocked=!1,<ref refid="getrss_8php_1abb0f8f809252372e25f48d52b63ef29d" kindref="member">$q</ref>.all([Spotify.get_user(),Api.get_all_drops()]).then(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(response){ngProgress.complete(),$scope.card.drop=response[1][0],$scope.card.track=$scope.card.drop.song_list[0],$scope.$watch(</highlight><highlight class="stringliteral">&quot;card.drop&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){$scope.card.track=$scope.card.drop.song_list[0],$scope.randomize()},!0),$timeout(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){$timeout(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){$scope.drops=response[1],$scope.card.user=response[0]},500)},500)},</highlight><highlight class="keyword">function</highlight><highlight class="normal">(response){ngProgress.complete(),$scope.auth_blocked=!0,console.log(</highlight><highlight class="stringliteral">&quot;error&quot;</highlight><highlight class="normal">)})),$scope.authenticate=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){Spotify.authenticate()},$scope.themes=[{text:</highlight><highlight class="stringliteral">&quot;#F59B23&quot;</highlight><highlight class="normal">,foreground:</highlight><highlight class="stringliteral">&quot;#AF2896&quot;</highlight><highlight class="normal">,background:</highlight><highlight class="stringliteral">&quot;#503750&quot;</highlight><highlight class="normal">,value:0},{text:</highlight><highlight class="stringliteral">&quot;#2D46B9&quot;</highlight><highlight class="normal">,foreground:</highlight><highlight class="stringliteral">&quot;#CDF564&quot;</highlight><highlight class="normal">,background:</highlight><highlight class="stringliteral">&quot;#FF4632&quot;</highlight><highlight class="normal">,value:1},{text:</highlight><highlight class="stringliteral">&quot;#F573A0&quot;</highlight><highlight class="normal">,foreground:</highlight><highlight class="stringliteral">&quot;#9BF0E1&quot;</highlight><highlight class="normal">,background:</highlight><highlight class="stringliteral">&quot;#503750&quot;</highlight><highlight class="normal">,value:2},{text:</highlight><highlight class="stringliteral">&quot;#000000&quot;</highlight><highlight class="normal">,foreground:</highlight><highlight class="stringliteral">&quot;#FAE62D&quot;</highlight><highlight class="normal">,background:</highlight><highlight class="stringliteral">&quot;#F037A5&quot;</highlight><highlight class="normal">,value:3}],$scope.background=</highlight><highlight class="stringliteral">&quot;/images/auth/auth.png&quot;</highlight><highlight class="normal">,$scope.bursts=[</highlight><highlight class="stringliteral">&quot;/images/bursts/triangle.png&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;/images/bursts/rectangle.png&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;/images/bursts/circle.png&quot;</highlight><highlight class="normal">],$scope.select_type=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(type){$scope.card.type=type},$scope.select_burst=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(burst){$scope.card.burst=burst},$scope.select_image=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(image){$scope.card.image=image},$scope.select_theme=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(theme){$scope.card.theme=theme},$scope.scale_background=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){$scope.card.scale=!$scope.card.scale},$scope.flip_background=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){$scope.card.flip=!$scope.card.flip},$scope.rotate_background=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){$scope.card.rotation=$scope.card.rotation&lt;3?++$scope.card.rotation:0},$scope.drag_background=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){$scope.drag=!$scope.drag},$scope.randomize=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){$scope.card.type=Math.random()&gt;=.5?</highlight><highlight class="stringliteral">&quot;burst&quot;</highlight><highlight class="normal">:</highlight><highlight class="stringliteral">&quot;image&quot;</highlight><highlight class="normal">,$scope.card.image=$scope.card.drop?$scope.card.drop.card_images[Math.floor(Math.random()*$scope.card.drop.card_images.length)]:</highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">,$scope.card.burst=$scope.bursts[Math.floor(Math.random()*$scope.bursts.length)],$scope.card.theme=$scope.themes[Math.floor(Math.random()*$scope.themes.length)],$scope.card.rotation=Math.floor(3*Math.random()),$scope.card.flip=Math.random()&gt;=.5,$scope.card.scale=Math.random()&gt;=.5}}]),angular.module(</highlight><highlight class="stringliteral">&quot;dropApp&quot;</highlight><highlight class="normal">).controller(</highlight><highlight class="stringliteral">&quot;DropCtrl&quot;</highlight><highlight class="normal">,[</highlight><highlight class="stringliteral">&quot;$scope&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;$routeParams&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;$timeout&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;$location&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;Api&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">($scope,$routeParams,$timeout,$location,Api){</highlight><highlight class="keyword">function</highlight><highlight class="normal"><sp/>load_drop(){isNaN($routeParams.id)?Api.get_featured().then(render_drop):Api.get_drop($routeParams.id).then(render_drop)}</highlight><highlight class="keyword">function</highlight><highlight class="normal"><sp/>render_drop(drop){</highlight><highlight class="stringliteral">&quot;i&quot;</highlight><highlight class="normal">===drop.dropped_at.charAt(0)||</highlight><highlight class="stringliteral">&quot;i&quot;</highlight><highlight class="normal">===drop.dropped_at.charAt(5)?drop.dropped=!1:drop.dropped=!0,$scope.drop=drop,$scope.drop.album_uri=</highlight><highlight class="stringliteral">&quot;spotify:album:&quot;</highlight><highlight class="normal">+$scope.drop.album_uri,$scope.drop.endpoint=</highlight><highlight class="stringliteral">&quot;http://open.spotify.com/&quot;</highlight><highlight class="normal">+$scope.drop.album_uri.replace(</highlight><highlight class="stringliteral">&quot;spotify:&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">).replace(/:/g,</highlight><highlight class="stringliteral">&quot;/&quot;</highlight><highlight class="normal">),$scope.spotify=</highlight><highlight class="stringliteral">&quot;/images/spotify.png&quot;</highlight><highlight class="normal">;</highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(var<sp/>i=$scope.drop.content.length;i--;i&gt;=0)$scope.drop.content[i].locked?$scope.drop.content.splice($scope.drop.content.length,0,$scope.drop.content.splice($scope.drop.content[i],1)[0]):$scope.items.unshift($scope.drop.content[i]);Api.get_ad().then(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(response){$scope.items.push(response)}),Api.get_cards().then(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(response){$scope.items.push(response[0])}),$timeout(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){$scope.$broadcast(</highlight><highlight class="stringliteral">&quot;timer-start&quot;</highlight><highlight class="normal">)},400),$scope.$on(</highlight><highlight class="stringliteral">&quot;$routeUpdate&quot;</highlight><highlight class="normal">,$scope.on_route_update),$scope.on_route_update()}$scope.items=[],$scope.clickWatch=0,$scope.set_media=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(index){$location.search(</highlight><highlight class="stringliteral">&quot;media&quot;</highlight><highlight class="normal">,index),$scope.clickWatch++},$scope.clear_media=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){$(</highlight><highlight class="stringliteral">&quot;.youtube-player<sp/>iframe&quot;</highlight><highlight class="normal">).</highlight><highlight class="keyword">remove</highlight><highlight class="normal">(),$location.url($location.path())},$scope.on_route_update=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){$scope.media_index=$location.search().media,$scope.media=$scope.drop.content[$scope.media_index]},load_drop()}]),angular.module(</highlight><highlight class="stringliteral">&quot;dropApp&quot;</highlight><highlight class="normal">).directive(</highlight><highlight class="stringliteral">&quot;audioPlayer&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){</highlight><highlight class="keywordflow">return</highlight><highlight class="normal">{scope:{uri:</highlight><highlight class="stringliteral">&quot;=audioPlayerUri&quot;</highlight><highlight class="normal">,albumUri:</highlight><highlight class="stringliteral">&quot;=audioPlayerAlbumUri&quot;</highlight><highlight class="normal">,revealDate:</highlight><highlight class="stringliteral">&quot;=audioPlayerRevealDate&quot;</highlight><highlight class="normal">},link:</highlight><highlight class="keyword">function</highlight><highlight class="normal">(scope,element){var<sp/>base=</highlight><highlight class="stringliteral">&apos;&lt;iframe<sp/>src=&quot;https://embed.spotify.com/?uri={uri}&quot;<sp/>width=&quot;100%&quot;<sp/>height=&quot;100%&quot;<sp/>frameborder=&quot;0&quot;<sp/>allowtransparency=&quot;true&quot;&gt;&lt;/iframe&gt;&apos;</highlight><highlight class="normal">;scope.afterRelease=!1,scope.$watch(</highlight><highlight class="stringliteral">&quot;revealDate&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){</highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(scope.revealDate){var<sp/>revealDate=moment(scope.revealDate),currentDate=moment(),diff=currentDate.diff(revealDate,</highlight><highlight class="stringliteral">&quot;seconds&quot;</highlight><highlight class="normal">);scope.afterRelease=diff&gt;0?!0:!1}}),scope.$watch(</highlight><highlight class="stringliteral">&quot;albumUri&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){scope.afterRelease&amp;&amp;(scope.albumUri?(element.html(base.replace(</highlight><highlight class="stringliteral">&quot;{uri}&quot;</highlight><highlight class="normal">,scope.albumUri)),setTimeout(function(){element.addClass(</highlight><highlight class="stringliteral">&quot;activated<sp/>album&quot;</highlight><highlight class="normal">)},500)):element.removeClass(</highlight><highlight class="stringliteral">&quot;activated&quot;</highlight><highlight class="normal">))}),scope.$watch(</highlight><highlight class="stringliteral">&quot;uri&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){scope.afterRelease||(scope.uri?(element.html(base.replace(</highlight><highlight class="stringliteral">&quot;{uri}&quot;</highlight><highlight class="normal">,scope.uri)),setTimeout(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){element.addClass(</highlight><highlight class="stringliteral">&quot;activated&quot;</highlight><highlight class="normal">)},500)):element.removeClass(</highlight><highlight class="stringliteral">&quot;activated&quot;</highlight><highlight class="normal">))})}}}),angular.module(</highlight><highlight class="stringliteral">&quot;dropApp&quot;</highlight><highlight class="normal">).directive(</highlight><highlight class="stringliteral">&quot;slider&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){</highlight><highlight class="keywordflow">return</highlight><highlight class="normal">{scope:{options:</highlight><highlight class="stringliteral">&quot;=sliderOptions&quot;</highlight><highlight class="normal">,switcher:</highlight><highlight class="stringliteral">&quot;=clickWatch&quot;</highlight><highlight class="normal">},templateUrl:</highlight><highlight class="stringliteral">&quot;/partials/slider.html&quot;</highlight><highlight class="normal">,transclude:!0,controller:[</highlight><highlight class="stringliteral">&quot;$scope&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">($scope){this.initialize=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){$scope.init()}}],link:</highlight><highlight class="keyword">function</highlight><highlight class="normal">(scope,element){var<sp/>defaults={grabCursor:!0,pagination:$(element).find(</highlight><highlight class="stringliteral">&quot;.swiper-pagination&quot;</highlight><highlight class="normal">),nextButton:$(element).find(</highlight><highlight class="stringliteral">&quot;.swiper-button-next&quot;</highlight><highlight class="normal">),prevButton:$(element).find(</highlight><highlight class="stringliteral">&quot;.swiper-button-prev&quot;</highlight><highlight class="normal">),paginationClickable:!0,preloadImages:!1,lazyLoading:!0};scope.$watch(</highlight><highlight class="stringliteral">&quot;switcher&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){$(</highlight><highlight class="stringliteral">&quot;.swiper-slide<sp/>.swiper-lazy&quot;</highlight><highlight class="normal">).each(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(idx){</highlight><highlight class="keyword">self</highlight><highlight class="normal">=$(</highlight><highlight class="keyword">this</highlight><highlight class="normal">),$(</highlight><highlight class="keyword">this</highlight><highlight class="normal">).attr(</highlight><highlight class="stringliteral">&quot;src&quot;</highlight><highlight class="normal">)&amp;&amp;(</highlight><highlight class="keyword">self</highlight><highlight class="normal">.removeClass(</highlight><highlight class="stringliteral">&quot;swiper-lazy-loaded&quot;</highlight><highlight class="normal">),</highlight><highlight class="keyword">self</highlight><highlight class="normal">.removeAttr(</highlight><highlight class="stringliteral">&quot;src&quot;</highlight><highlight class="normal">),setTimeout(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){s.lazy.load()}))})});var<sp/>s,options=angular.extend(defaults,scope.options);scope.init=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){s&amp;&amp;s.destroy(),setTimeout(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){s=</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Swiper(element[0],options)},100)}}}}),angular.module(</highlight><highlight class="stringliteral">&quot;dropApp&quot;</highlight><highlight class="normal">).directive(</highlight><highlight class="stringliteral">&quot;sliderItem&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){</highlight><highlight class="keywordflow">return</highlight><highlight class="normal">{require:</highlight><highlight class="stringliteral">&quot;^slider&quot;</highlight><highlight class="normal">,link:</highlight><highlight class="keyword">function</highlight><highlight class="normal">(scope,element,attrs,sliderCtrl){scope.$last&amp;&amp;sliderCtrl.initialize()}}}),angular.module(</highlight><highlight class="stringliteral">&quot;dropApp&quot;</highlight><highlight class="normal">).directive(</highlight><highlight class="stringliteral">&quot;mediaCircle&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){</highlight><highlight class="keywordflow">return</highlight><highlight class="normal">{templateUrl:</highlight><highlight class="stringliteral">&quot;partials/media-circle.html&quot;</highlight><highlight class="normal">,link:</highlight><highlight class="keyword">function</highlight><highlight class="normal">(scope,element){var<sp/>r=4*Math.random()+2.5,t=.25*Math.PI,labelX=r+r*Math.cos(t),labelY=r+r*Math.sin(t);scope.circleStyle={width:2*r+</highlight><highlight class="stringliteral">&quot;em&quot;</highlight><highlight class="normal">,height:2*r+</highlight><highlight class="stringliteral">&quot;em&quot;</highlight><highlight class="normal">},scope.labelStyle={top:labelY+</highlight><highlight class="stringliteral">&quot;em&quot;</highlight><highlight class="normal">,left:labelX+</highlight><highlight class="stringliteral">&quot;em&quot;</highlight><highlight class="normal">},setTimeout(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){element.addClass(</highlight><highlight class="stringliteral">&quot;revealed&quot;</highlight><highlight class="normal">)},200*scope.$index+1500)}}}),angular.module(</highlight><highlight class="stringliteral">&quot;dropApp&quot;</highlight><highlight class="normal">).directive(</highlight><highlight class="stringliteral">&quot;imageLoader&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){</highlight><highlight class="keywordflow">return</highlight><highlight class="normal">{scope:{imageLoaderSrc:</highlight><highlight class="stringliteral">&quot;=imageLoaderSrc&quot;</highlight><highlight class="normal">},</highlight><highlight class="keyword">template</highlight><highlight class="normal">:</highlight><highlight class="stringliteral">&apos;&lt;div<sp/>class=&quot;image-loader-element&quot;<sp/>ng-style=&quot;backgroundImage&quot;&gt;&lt;/div&gt;&lt;div<sp/>class=&quot;image-loader-progress&quot;&gt;&lt;/div&gt;&apos;</highlight><highlight class="normal">,link:</highlight><highlight class="keyword">function</highlight><highlight class="normal">(scope,element,attrs){</highlight><highlight class="keyword">function</highlight><highlight class="normal"><sp/>loadImage(){image=</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Image,image.onload=onImageLoaded,image.src=scope.imageLoaderSrc,element.removeClass(</highlight><highlight class="stringliteral">&quot;image-loader-complete&quot;</highlight><highlight class="normal">).addClass(</highlight><highlight class="stringliteral">&quot;image-loader-loading&quot;</highlight><highlight class="normal">)}</highlight><highlight class="keyword">function</highlight><highlight class="normal"><sp/>onImageLoaded(){</highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>0!==attrs.backgroundImage&amp;&amp;scope.$emit(</highlight><highlight class="stringliteral">&quot;imageLoaded&quot;</highlight><highlight class="normal">),element.removeClass(</highlight><highlight class="stringliteral">&quot;image-loader-loading&quot;</highlight><highlight class="normal">).addClass(</highlight><highlight class="stringliteral">&quot;image-loader-complete&quot;</highlight><highlight class="normal">).children().first().css(</highlight><highlight class="stringliteral">&quot;background-image&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;url(&quot;</highlight><highlight class="normal">+scope.imageLoaderSrc+</highlight><highlight class="stringliteral">&quot;)&quot;</highlight><highlight class="normal">)}</highlight><highlight class="keyword">function</highlight><highlight class="normal"><sp/>onImageError(){element.removeClass(</highlight><highlight class="stringliteral">&quot;image-loader-loading&quot;</highlight><highlight class="normal">).removeClass(</highlight><highlight class="stringliteral">&quot;image-loader-complete&quot;</highlight><highlight class="normal">)}var<sp/>image;scope.$watch(</highlight><highlight class="stringliteral">&quot;imageLoaderSrc&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">(val){val?setTimeout(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){loadImage()},300):onImageError()})}}}),angular.module(</highlight><highlight class="stringliteral">&quot;dropApp&quot;</highlight><highlight class="normal">).directive(</highlight><highlight class="stringliteral">&quot;gallery&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){</highlight><highlight class="keywordflow">return</highlight><highlight class="normal">{scope:{items:</highlight><highlight class="stringliteral">&quot;=galleryItems&quot;</highlight><highlight class="normal">},templateUrl:</highlight><highlight class="stringliteral">&quot;partials/gallery.html&quot;</highlight><highlight class="normal">,link:</highlight><highlight class="keyword">function</highlight><highlight class="normal">(scope,element,attrs){scope.gallerySliderOptions={slidesPerView:1,pagination:</highlight><highlight class="stringliteral">&quot;.swiper-pagination&quot;</highlight><highlight class="normal">,nextButton:</highlight><highlight class="stringliteral">&quot;.swiper-button-next&quot;</highlight><highlight class="normal">,prevButton:</highlight><highlight class="stringliteral">&quot;.swiper-button-prev&quot;</highlight><highlight class="normal">,paginationClickable:!0,preloadImages:!1,lazyLoading:!0,loop:!0}}}}),angular.module(</highlight><highlight class="stringliteral">&quot;dropApp&quot;</highlight><highlight class="normal">).directive(</highlight><highlight class="stringliteral">&quot;youtubePlayer&quot;</highlight><highlight class="normal">,[</highlight><highlight class="stringliteral">&quot;$sce&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;$timeout&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">($sce,$timeout){</highlight><highlight class="keywordflow">return</highlight><highlight class="normal">{scope:{data:</highlight><highlight class="stringliteral">&quot;=youtubePlayer&quot;</highlight><highlight class="normal">},templateUrl:</highlight><highlight class="stringliteral">&quot;partials/videoplayer.html&quot;</highlight><highlight class="normal">,link:</highlight><highlight class="keyword">function</highlight><highlight class="normal">(scope,element,attrs){var<sp/>id,base=</highlight><highlight class="stringliteral">&quot;http://www.youtube.com/embed/{id}?autoplay=1&amp;showinfo=0&amp;rel=0&amp;autohide=1&amp;showinfo=0&amp;enablejsapi=1&amp;playerapiid=ytplaye&quot;</highlight><highlight class="normal">;scope.visible=!1,scope.$watch(</highlight><highlight class="stringliteral">&quot;data&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){</highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(scope.data&amp;&amp;scope.data.content){if(!scope.data.content.url)return<sp/>void<sp/>scope.stop();id=scope.data.content.url.split(</highlight><highlight class="stringliteral">&quot;watch?v=&quot;</highlight><highlight class="normal">)[1],$timeout(scope.play,500)}</highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>scope.stop()}),scope.play=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){scope.iframe_url=$sce.trustAsResourceUrl(base.replace(</highlight><highlight class="stringliteral">&quot;{id}&quot;</highlight><highlight class="normal">,</highlight><highlight class="keywordtype">id</highlight><highlight class="normal">)),scope.playing=!0},scope.stop=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){scope.iframe_url=$sce.trustAsResourceUrl(</highlight><highlight class="stringliteral">&quot;about:blank&quot;</highlight><highlight class="normal">),scope.playing=!1},window.uploadDone=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){scope.data&amp;&amp;(scope.visible=!0,scope.$apply())}}}}]),angular.module(</highlight><highlight class="stringliteral">&quot;dropApp&quot;</highlight><highlight class="normal">).directive(</highlight><highlight class="stringliteral">&quot;packery&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){</highlight><highlight class="keywordflow">return</highlight><highlight class="normal">{scope:!0,controller:[</highlight><highlight class="stringliteral">&quot;$scope&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">($scope){this.initialize=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){$scope.init()}}],link:</highlight><highlight class="keyword">function</highlight><highlight class="normal">(scope,element,attrs){var<sp/>p,defaults={itemSelector:</highlight><highlight class="stringliteral">&quot;.block-item&quot;</highlight><highlight class="normal">,percentPosition:!0,masonry:{columnWidth:</highlight><highlight class="stringliteral">&quot;.block-item-small&quot;</highlight><highlight class="normal">}};scope.init=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){setTimeout(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){p=</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Isotope(element[0],defaults)},200),setTimeout(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){p.arrange()},300)}}}}),angular.module(</highlight><highlight class="stringliteral">&quot;dropApp&quot;</highlight><highlight class="normal">).directive(</highlight><highlight class="stringliteral">&quot;packeryItem&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){</highlight><highlight class="keywordflow">return</highlight><highlight class="normal">{require:</highlight><highlight class="stringliteral">&quot;^packery&quot;</highlight><highlight class="normal">,link:</highlight><highlight class="keyword">function</highlight><highlight class="normal">(scope,element,attrs,packeryCtrl){scope.$last&amp;&amp;packeryCtrl.initialize()}}}),angular.module(</highlight><highlight class="stringliteral">&quot;dropApp&quot;</highlight><highlight class="normal">).directive(</highlight><highlight class="stringliteral">&quot;blockItem&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){</highlight><highlight class="keywordflow">return</highlight><highlight class="normal">{scope:{data:</highlight><highlight class="stringliteral">&quot;=blockItemData&quot;</highlight><highlight class="normal">},</highlight><highlight class="keyword">template</highlight><highlight class="normal">:</highlight><highlight class="stringliteral">&apos;&lt;div<sp/>ng-include=&quot;get_template_url()&quot;&gt;&lt;/div&gt;&apos;</highlight><highlight class="normal">,link:</highlight><highlight class="keyword">function</highlight><highlight class="normal">(scope,element,attrs){</highlight><highlight class="keyword">function</highlight><highlight class="normal"><sp/>generate_media_cta(type){</highlight><highlight class="keywordflow">switch</highlight><highlight class="normal">(type){</highlight><highlight class="keywordflow">case</highlight><highlight class="stringliteral">&quot;video&quot;</highlight><highlight class="normal">:</highlight><highlight class="keywordflow">return</highlight><highlight class="stringliteral">&quot;watch<sp/>now&quot;</highlight><highlight class="normal">;</highlight><highlight class="keywordflow">case</highlight><highlight class="stringliteral">&quot;playlist&quot;</highlight><highlight class="normal">:</highlight><highlight class="keywordflow">return</highlight><highlight class="stringliteral">&quot;listen&quot;</highlight><highlight class="normal">;</highlight><highlight class="keywordflow">case</highlight><highlight class="stringliteral">&quot;single&quot;</highlight><highlight class="normal">:</highlight><highlight class="keywordflow">return</highlight><highlight class="stringliteral">&quot;listen&quot;</highlight><highlight class="normal">;</highlight><highlight class="keywordflow">case</highlight><highlight class="stringliteral">&quot;gallery&quot;</highlight><highlight class="normal">:</highlight><highlight class="keywordflow">return</highlight><highlight class="stringliteral">&quot;view<sp/>now&quot;</highlight><highlight class="normal">;</highlight><highlight class="keywordflow">default</highlight><highlight class="normal">:</highlight><highlight class="keywordflow">return</highlight><highlight class="stringliteral">&quot;view<sp/>&quot;</highlight><highlight class="normal">+type}}</highlight><highlight class="keyword">function</highlight><highlight class="normal"><sp/>get_image_url(</highlight><highlight class="keywordtype">id</highlight><highlight class="normal">,files){</highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>files[id]?files[id].url:null}</highlight><highlight class="keyword">function</highlight><highlight class="normal"><sp/>build_card(){</highlight><highlight class="keywordflow">switch</highlight><highlight class="normal">(scope.data.type){</highlight><highlight class="keywordflow">case</highlight><highlight class="stringliteral">&quot;card&quot;</highlight><highlight class="normal">:scope.template_url=</highlight><highlight class="stringliteral">&quot;partials/block-item-card.html&quot;</highlight><highlight class="normal">,scope.cta=</highlight><highlight class="stringliteral">&quot;create<sp/>your<sp/>card&quot;</highlight><highlight class="normal">,scope.image=get_image_url(scope.data.image_id,scope.data.files),element.addClass(</highlight><highlight class="stringliteral">&quot;block-item-small<sp/>block-item-card&quot;</highlight><highlight class="normal">);</highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight><highlight class="keywordflow">case</highlight><highlight class="stringliteral">&quot;ad&quot;</highlight><highlight class="normal">:scope.template_url=</highlight><highlight class="stringliteral">&quot;partials/block-item-ad.html&quot;</highlight><highlight class="normal">,scope.cta=</highlight><highlight class="stringliteral">&quot;listen<sp/>now&quot;</highlight><highlight class="normal">,element.addClass(</highlight><highlight class="stringliteral">&quot;block-item-small<sp/>block-item-ad&quot;</highlight><highlight class="normal">);</highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight><highlight class="keywordflow">case</highlight><highlight class="stringliteral">&quot;media&quot;</highlight><highlight class="normal">:scope.template_url=</highlight><highlight class="stringliteral">&quot;partials/block-item-media.html&quot;</highlight><highlight class="normal">,scope.cta=generate_media_cta(scope.data.media_type),element.addClass(</highlight><highlight class="stringliteral">&quot;video&quot;</highlight><highlight class="normal">===scope.data.media_type?</highlight><highlight class="stringliteral">&quot;block-item-large&quot;</highlight><highlight class="normal">:</highlight><highlight class="stringliteral">&quot;block-item-small&quot;</highlight><highlight class="normal">);</highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight><highlight class="keywordflow">case</highlight><highlight class="stringliteral">&quot;drop&quot;</highlight><highlight class="normal">:scope.template_url=</highlight><highlight class="stringliteral">&quot;partials/block-item-drop.html&quot;</highlight><highlight class="normal">,scope.cta=</highlight><highlight class="stringliteral">&quot;view<sp/>drop&quot;</highlight><highlight class="normal">,element.addClass(</highlight><highlight class="stringliteral">&quot;block-item-small&quot;</highlight><highlight class="normal">)}</highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!scope.data.image&amp;&amp;!scope.data.featured_image){var<sp/>random_drop_style=Math.floor(5*Math.random());element.addClass(</highlight><highlight class="stringliteral">&quot;drop-style-&quot;</highlight><highlight class="normal">+random_drop_style)}}scope.$watch(</highlight><highlight class="stringliteral">&quot;data&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">(val){val&amp;&amp;build_card()}),scope.get_template_url=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){</highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>scope.template_url},scope.is_playing=!1,scope.toggle_music=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){scope.is_playing?(scope.is_playing=!1,element.removeClass(</highlight><highlight class="stringliteral">&quot;block-item-playing&quot;</highlight><highlight class="normal">),scope.audio_uri=null):(scope.is_playing=!0,element.addClass(</highlight><highlight class="stringliteral">&quot;block-item-playing&quot;</highlight><highlight class="normal">),scope.audio_uri=</highlight><highlight class="stringliteral">&quot;spotify:track:1XALSFY5nrFQ9NaI2XNp9t&quot;</highlight><highlight class="normal">,console.log(</highlight><highlight class="stringliteral">&quot;playing&quot;</highlight><highlight class="normal">))}}}}),angular.module(</highlight><highlight class="stringliteral">&quot;dropApp&quot;</highlight><highlight class="normal">).directive(</highlight><highlight class="stringliteral">&quot;dropCard&quot;</highlight><highlight class="normal">,[</highlight><highlight class="stringliteral">&quot;Image&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;Api&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">(Image,Api){</highlight><highlight class="keywordflow">return</highlight><highlight class="normal">{scope:!1,restrict:</highlight><highlight class="stringliteral">&quot;A&quot;</highlight><highlight class="normal">,link:</highlight><highlight class="keyword">function</highlight><highlight class="normal">(scope,element,attrs){</highlight><highlight class="keyword">function</highlight><highlight class="normal"><sp/>render_background(){var<sp/>is_burst=</highlight><highlight class="stringliteral">&quot;burst&quot;</highlight><highlight class="normal">===scope.card.type;background.onImageLoaded(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){var<sp/>img_data=background.getOriginalImageData();img_data=Image.duotone(img_data,scope.card.theme.background,scope.card.theme.foreground),img_data=scope.card.flip?Image.flipImage(img_data):img_data,background.setImageData(img_data),background.setRotation(is_burst?90*scope.card.rotation:0),background.update(!is_burst&amp;&amp;scope.card.scale?{w:900,h:900,x:-300,y:-300}:{w:450,h:450,x:-75,y:-75})}),card.background.update({fill:scope.card.theme.background}),background.changeURL(is_burst?scope.card.burst:scope.card.image)}</highlight><highlight class="keyword">function</highlight><highlight class="normal"><sp/>render_text(){</highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>scope.card.track?(text.song.changeText(scope.card.track),text.songxs.changeText(</highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">),text.artist.changeText(scope.card.drop.album),text.song.w&gt;270?(text.song.changeText(</highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">),text.songxs.changeText(scope.card.track),format_text(</highlight><highlight class="stringliteral">&quot;small&quot;</highlight><highlight class="normal">),text.songxs.w&gt;270&amp;&amp;text.songxs.truncate(270)):format_text(</highlight><highlight class="stringliteral">&quot;normal&quot;</highlight><highlight class="normal">),void(text.artist.w&gt;200&amp;&amp;text.artist.truncate(200))):!1}</highlight><highlight class="keyword">function</highlight><highlight class="normal"><sp/>format_text(type){</highlight><highlight class="keywordflow">switch</highlight><highlight class="normal">(type){</highlight><highlight class="keywordflow">case</highlight><highlight class="stringliteral">&quot;small&quot;</highlight><highlight class="normal">:text.headline.update({y:100}),text.songxs.update({y:138}),text.from.update({y:170}),text.artist.update({y:170});</highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight><highlight class="keywordflow">default</highlight><highlight class="normal">:text.headline.update({y:100}),text.song.update({y:145}),text.from.update({y:178}),text.artist.update({y:178})}</highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(var<sp/>t<sp/>in<sp/>text)text[t].update({fill:scope.card.theme.text})}</highlight><highlight class="keyword">function</highlight><highlight class="normal"><sp/>render_user(){</highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(scope.card.user){var<sp/>img=</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>window.Image;img.crossOrigin=</highlight><highlight class="stringliteral">&quot;Anonymous&quot;</highlight><highlight class="normal">,img.onload=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){var<sp/>c=document.createElement(</highlight><highlight class="stringliteral">&quot;canvas&quot;</highlight><highlight class="normal">),ctx=c.getContext(</highlight><highlight class="stringliteral">&quot;2d&quot;</highlight><highlight class="normal">);ctx.beginPath(),ctx.arc(25,25,25,0,2*Math.PI,!0),ctx.closePath(),ctx.fill(),ctx.clip(),ctx.drawImage(</highlight><highlight class="keyword">this</highlight><highlight class="normal">,0,0,50,50);var<sp/>d=ctx.getImageData(0,0,50,50);avatar.setImageData(d),avatar.update({y:15})},img.src=scope.card.user.images[0].url,username.changeText(scope.card.user.display_name),username.update({y:35})}}</highlight><highlight class="keyword">function</highlight><highlight class="normal"><sp/>onMouseLeave(){is_dragging=!1}</highlight><highlight class="keyword">function</highlight><highlight class="normal"><sp/>onMouseDown(x,y){drag_position.x=x-background.x,drag_position.y=y-background.y,is_dragging=!0}</highlight><highlight class="keyword">function</highlight><highlight class="normal"><sp/>onMouseUp(){is_dragging=!1}</highlight><highlight class="keyword">function</highlight><highlight class="normal"><sp/>onMouseMove(x,y){</highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(is_dragging){var<sp/>_x=x-drag_position.x,_y=y-drag_position.y;_x&gt;=-1?_x=-1:_x+background.w&lt;=card.width-1&amp;&amp;(_x=card.width-background.w+1),_y&gt;=-1?_y=-1:_y+background.h&lt;=card.height-1&amp;&amp;(_y=card.height-background.h+1),background.update({x:_x,y:_y})}}var<sp/>card=</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Postcard(element[0],{filename:</highlight><highlight class="stringliteral">&quot;dropcard.png&quot;</highlight><highlight class="normal">}),background=card.addImage(</highlight><highlight class="stringliteral">&quot;background&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">),avatar=(card.addImage(</highlight><highlight class="stringliteral">&quot;bottomLogos&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;/images/bottomlogos.png&quot;</highlight><highlight class="normal">,{x:0,y:260,w:300,h:40}),card.addImage(</highlight><highlight class="stringliteral">&quot;avatar&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;/images/sample-profile.png&quot;</highlight><highlight class="normal">,{x:15,y:-45,w:35,h:35})),username=card.addText(</highlight><highlight class="stringliteral">&quot;username&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">,10,{x:58,y:-35,family:</highlight><highlight class="stringliteral">&quot;light&quot;</highlight><highlight class="normal">,size:</highlight><highlight class="stringliteral">&quot;14px&quot;</highlight><highlight class="normal">}),text={headline:card.addText(</highlight><highlight class="stringliteral">&quot;intro&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;I&apos;m<sp/>feeling&quot;</highlight><highlight class="normal">,10,{x:15,y:-15,family:</highlight><highlight class="stringliteral">&quot;light&quot;</highlight><highlight class="normal">,size:</highlight><highlight class="stringliteral">&quot;20px&quot;</highlight><highlight class="normal">}),song:card.addText(</highlight><highlight class="stringliteral">&quot;song&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">,10,{x:15,y:128,family:</highlight><highlight class="stringliteral">&quot;bold&quot;</highlight><highlight class="normal">,size:</highlight><highlight class="stringliteral">&quot;40px&quot;</highlight><highlight class="normal">}),songxs:card.addText(</highlight><highlight class="stringliteral">&quot;song.small&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">,10,{x:15,y:121,family:</highlight><highlight class="stringliteral">&quot;bold&quot;</highlight><highlight class="normal">,size:</highlight><highlight class="stringliteral">&quot;30px&quot;</highlight><highlight class="normal">}),from:card.addText(</highlight><highlight class="stringliteral">&quot;from&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;from&quot;</highlight><highlight class="normal">,10,{x:15,y:-15,family:</highlight><highlight class="stringliteral">&quot;light&quot;</highlight><highlight class="normal">,size:</highlight><highlight class="stringliteral">&quot;20px&quot;</highlight><highlight class="normal">}),artist:card.addText(</highlight><highlight class="stringliteral">&quot;artist&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">,10,{x:63,y:-15,family:</highlight><highlight class="stringliteral">&quot;bold&quot;</highlight><highlight class="normal">,size:</highlight><highlight class="stringliteral">&quot;20px&quot;</highlight><highlight class="normal">}),cta:card.addText(</highlight><highlight class="stringliteral">&quot;cta&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;Album<sp/>out<sp/>now&quot;</highlight><highlight class="normal">,10,{x:15,y:-15,family:</highlight><highlight class="stringliteral">&quot;light&quot;</highlight><highlight class="normal">,size:</highlight><highlight class="stringliteral">&quot;15px&quot;</highlight><highlight class="normal">})};scope.refresh=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){scope.saved=!1,render_background(),render_text(),render_user()},scope.$watch(</highlight><highlight class="stringliteral">&quot;card&quot;</highlight><highlight class="normal">,scope.refresh,!0),scope.randomize();var<sp/>is_dragging=!1,drag_position={};scope.$watch(</highlight><highlight class="stringliteral">&quot;drag&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){scope.drag?(element.css(</highlight><highlight class="stringliteral">&quot;cursor&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;move&quot;</highlight><highlight class="normal">).bind(</highlight><highlight class="stringliteral">&quot;mouseleave&quot;</highlight><highlight class="normal">,onMouseLeave),card.onMouseDown(onMouseDown),card.onMouseUp(onMouseUp),card.onMouseMove(onMouseMove)):(element.css(</highlight><highlight class="stringliteral">&quot;cursor&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;auto&quot;</highlight><highlight class="normal">),card.clearMouseEvents())}),scope.save=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){Api.save_card(scope.card,card[</highlight><highlight class="stringliteral">&quot;export&quot;</highlight><highlight class="normal">]()).then(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(response){scope.saved=!0,Api.get_single_card(response).then(</highlight><highlight class="keyword">function</highlight><highlight class="normal">(data){scope.imageUrl=encodeURIComponent(data.files[data.image_id].url)})})},scope.download=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(event){card.save(event)},PostcardTextObject.prototype.truncate=</highlight><highlight class="keyword">function</highlight><highlight class="normal">(width){</highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(var<sp/>t=this.text,i=0;this.w&gt;width;)this.changeText(t.substr(0,t.length-++i)+</highlight><highlight class="stringliteral">&quot;...&quot;</highlight><highlight class="normal">)}}}}]),angular.module(</highlight><highlight class="stringliteral">&quot;dropApp&quot;</highlight><highlight class="normal">).directive(</highlight><highlight class="stringliteral">&quot;mediaIcon&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){</highlight><highlight class="keywordflow">return</highlight><highlight class="normal">{scope:{media:</highlight><highlight class="stringliteral">&quot;=mediaIcon&quot;</highlight><highlight class="normal">},link:</highlight><highlight class="keyword">function</highlight><highlight class="normal">(scope,element,attrs){scope.$watch(</highlight><highlight class="stringliteral">&quot;media&quot;</highlight><highlight class="normal">,</highlight><highlight class="keyword">function</highlight><highlight class="normal">(){</highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(element.removeClass(),scope.media.locked)element.replaceWith(</highlight><highlight class="stringliteral">&apos;&lt;div<sp/>class=&quot;exlusive-video&quot;&gt;&lt;img<sp/>src=&quot;/images/icons/Locked-white.svg&quot;&gt;&lt;span&gt;Locked<sp/>Content&lt;/span&gt;&lt;/div&gt;&apos;</highlight><highlight class="normal">);</highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal">(scope.media.media_type){</highlight><highlight class="keywordflow">case</highlight><highlight class="stringliteral">&quot;video&quot;</highlight><highlight class="normal">:element.replaceWith(</highlight><highlight class="stringliteral">&apos;&lt;div<sp/>class=&quot;exlusive-video&quot;&gt;&lt;img<sp/>src=&quot;/images/icons/Video-white.svg&quot;&gt;&lt;span&gt;Exclusive<sp/>Video&lt;/span&gt;&lt;/div&gt;&apos;</highlight><highlight class="normal">);</highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight><highlight class="keywordflow">case</highlight><highlight class="stringliteral">&quot;playlist&quot;</highlight><highlight class="normal">:element.replaceWith(</highlight><highlight class="stringliteral">&apos;&lt;div<sp/>class=&quot;exlusive-video&quot;&gt;&lt;img<sp/>src=&quot;/images/icons/Playlist-white.svg&quot;&gt;&lt;span&gt;Exclusive<sp/>Playlist&lt;/span&gt;&lt;/div&gt;&apos;</highlight><highlight class="normal">);</highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight><highlight class="keywordflow">case</highlight><highlight class="stringliteral">&quot;single&quot;</highlight><highlight class="normal">:element.addClass(</highlight><highlight class="stringliteral">&quot;fa<sp/>fa-play&quot;</highlight><highlight class="normal">);</highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight><highlight class="keywordflow">case</highlight><highlight class="stringliteral">&quot;gallery&quot;</highlight><highlight class="normal">:element.replaceWith(</highlight><highlight class="stringliteral">&apos;&lt;div<sp/>class=&quot;exlusive-video&quot;&gt;&lt;img<sp/>src=&quot;/images/icons/Gallery-white.svg&quot;&gt;&lt;span&gt;Exclusive<sp/>Gallery&lt;/span&gt;&lt;/div&gt;&apos;</highlight><highlight class="normal">)}})}}});</highlight></codeline>
    </programlisting>
    <location file="/home/leif/Dropbox/Software3308-Group1/FinalSubmission/GeoReport/scripts/scripts.js"/>
  </compounddef>
</doxygen>
